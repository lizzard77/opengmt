const xn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}};xn();function N(){}const wn=n=>n;function ae(n,e){for(const t in e)n[t]=e[t];return n}function On(n){return n&&typeof n=="object"&&typeof n.then=="function"}function kn(n){return n()}function $t(){return Object.create(null)}function se(n){n.forEach(kn)}function bt(n){return typeof n=="function"}function K(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function An(n){return Object.keys(n).length===0}function yn(n,...e){if(n==null)return N;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function H(n,e,t){n.$$.on_destroy.push(yn(e,t))}function Oe(n,e,t,o){if(n){const r=Sn(n,e,t,o);return n[0](r)}}function Sn(n,e,t,o){return n[1]&&o?ae(t.ctx.slice(),n[1](o(e))):t.ctx}function Ae(n,e,t,o){if(n[2]&&o){const r=n[2](o(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const i=[],s=Math.max(e.dirty.length,r.length);for(let c=0;c<s;c+=1)i[c]=e.dirty[c]|r[c];return i}return e.dirty|r}return e.dirty}function Me(n,e,t,o,r,i){if(r){const s=Sn(e,t,o,i);n.p(s,r)}}function Ne(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let o=0;o<t;o++)e[o]=-1;return e}return-1}function Fe(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}function Xe(n,e){const t={};e=new Set(e);for(const o in n)!e.has(o)&&o[0]!=="$"&&(t[o]=n[o]);return t}function B(n,e,t){return n.set(t),e}const vn=typeof window!="undefined";let Mn=vn?()=>window.performance.now():()=>Date.now(),wt=vn?n=>requestAnimationFrame(n):N;const ke=new Set;function Cn(n){ke.forEach(e=>{e.c(n)||(ke.delete(e),e.f())}),ke.size!==0&&wt(Cn)}function Nn(n){let e;return ke.size===0&&wt(Cn),{promise:new Promise(t=>{ke.add(e={c:n,f:t})}),abort(){ke.delete(e)}}}function y(n,e){n.appendChild(e)}function En(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function zn(n){const e=I("style");return Hn(En(n),e),e.sheet}function Hn(n,e){y(n.head||n,e)}function E(n,e,t){n.insertBefore(e,t||null)}function C(n){n.parentNode.removeChild(n)}function ue(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function I(n){return document.createElement(n)}function me(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function D(n){return document.createTextNode(n)}function x(){return D(" ")}function ee(){return D("")}function A(n,e,t,o){return n.addEventListener(e,t,o),()=>n.removeEventListener(e,t,o)}function S(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Qe(n,e){const t=Object.getOwnPropertyDescriptors(n.__proto__);for(const o in e)e[o]==null?n.removeAttribute(o):o==="style"?n.style.cssText=e[o]:o==="__value"?n.value=n[o]=e[o]:t[o]&&t[o].set?n[o]=e[o]:S(n,o,e[o])}function tt(n){return n===""?null:+n}function Wn(n){return Array.from(n.childNodes)}function Q(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function ye(n,e){n.value=e==null?"":e}function z(n,e,t,o){t===null?n.style.removeProperty(e):n.style.setProperty(e,t,o?"important":"")}let He;function jn(){if(He===void 0){He=!1;try{typeof window!="undefined"&&window.parent&&window.parent.document}catch{He=!0}}return He}function Ln(n,e){getComputedStyle(n).position==="static"&&(n.style.position="relative");const o=I("iframe");o.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),o.setAttribute("aria-hidden","true"),o.tabIndex=-1;const r=jn();let i;return r?(o.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=A(window,"message",s=>{s.source===o.contentWindow&&e()})):(o.src="about:blank",o.onload=()=>{i=A(o.contentWindow,"resize",e)}),y(n,o),()=>{(r||i&&o.contentWindow)&&i(),C(o)}}function In(n,e,{bubbles:t=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(n,t,o,e),r}const Ke=new Map;let Ye=0;function Un(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function qn(n,e){const t={stylesheet:zn(e),rules:{}};return Ke.set(n,t),t}function Dt(n,e,t,o,r,i,s,c=0){const l=16.666/o;let a=`{
`;for(let g=0;g<=1;g+=l){const m=e+(t-e)*i(g);a+=g*100+`%{${s(m,1-m)}}
`}const u=a+`100% {${s(t,1-t)}}
}`,f=`__svelte_${Un(u)}_${c}`,d=En(n),{stylesheet:h,rules:_}=Ke.get(d)||qn(d,n);_[f]||(_[f]=!0,h.insertRule(`@keyframes ${f} ${u}`,h.cssRules.length));const k=n.style.animation||"";return n.style.animation=`${k?`${k}, `:""}${f} ${o}ms linear ${r}ms 1 both`,Ye+=1,f}function Bn(n,e){const t=(n.style.animation||"").split(", "),o=t.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),r=t.length-o.length;r&&(n.style.animation=o.join(", "),Ye-=r,Ye||Fn())}function Fn(){wt(()=>{Ye||(Ke.forEach(n=>{const{stylesheet:e}=n;let t=e.cssRules.length;for(;t--;)e.deleteRule(t);n.rules={}}),Ke.clear())})}let Pe;function fe(n){Pe=n}function be(){if(!Pe)throw new Error("Function called outside component initialization");return Pe}function Xn(n){be().$$.on_mount.push(n)}function Qn(n){be().$$.after_update.push(n)}function Kn(n){be().$$.on_destroy.push(n)}function kt(){const n=be();return(e,t,{cancelable:o=!1}={})=>{const r=n.$$.callbacks[e];if(r){const i=In(e,t,{cancelable:o});return r.slice().forEach(s=>{s.call(n,i)}),!i.defaultPrevented}return!0}}function xt(n,e){return be().$$.context.set(n,e),e}function Se(n){return be().$$.context.get(n)}function Yn(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(o=>o.call(this,e))}const Ie=[],te=[],qe=[],ut=[],Jn=Promise.resolve();let ft=!1;function Vn(){ft||(ft=!0,Jn.then(yt))}function de(n){qe.push(n)}function le(n){ut.push(n)}const it=new Set;let We=0;function yt(){const n=Pe;do{for(;We<Ie.length;){const e=Ie[We];We++,fe(e),Zn(e.$$)}for(fe(null),Ie.length=0,We=0;te.length;)te.pop()();for(let e=0;e<qe.length;e+=1){const t=qe[e];it.has(t)||(it.add(t),t())}qe.length=0}while(Ie.length);for(;ut.length;)ut.pop()();ft=!1,it.clear(),fe(n)}function Zn(n){if(n.fragment!==null){n.update(),se(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(de)}}let Ee;function Gn(){return Ee||(Ee=Promise.resolve(),Ee.then(()=>{Ee=null})),Ee}function st(n,e,t){n.dispatchEvent(In(`${e?"intro":"outro"}${t}`))}const Be=new Set;let he;function pe(){he={r:0,c:[],p:he}}function ge(){he.r||se(he.c),he=he.p}function T(n,e){n&&n.i&&(Be.delete(n),n.i(e))}function R(n,e,t,o){if(n&&n.o){if(Be.has(n))return;Be.add(n),he.c.push(()=>{Be.delete(n),o&&(t&&n.d(1),o())}),n.o(e)}else o&&o()}const eo={duration:0};function Ot(n,e,t,o){let r=e(n,t),i=o?0:1,s=null,c=null,l=null;function a(){l&&Bn(n,l)}function u(d,h){const _=d.b-i;return h*=Math.abs(_),{a:i,b:d.b,d:_,duration:h,start:d.start,end:d.start+h,group:d.group}}function f(d){const{delay:h=0,duration:_=300,easing:k=wn,tick:g=N,css:m}=r||eo,p={start:Mn()+h,b:d};d||(p.group=he,he.r+=1),s||c?c=p:(m&&(a(),l=Dt(n,i,d,_,h,k,m)),d&&g(0,1),s=u(p,_),de(()=>st(n,d,"start")),Nn(v=>{if(c&&v>c.start&&(s=u(c,_),c=null,st(n,s.b,"start"),m&&(a(),l=Dt(n,i,s.b,s.duration,0,k,r.css))),s){if(v>=s.end)g(i=s.b,1-i),st(n,s.b,"end"),c||(s.b?a():--s.group.r||se(s.group.c)),s=null;else if(v>=s.start){const w=v-s.start;i=s.a+s.d*k(w/s.duration),g(i,1-i)}}return!!(s||c)}))}return{run(d){bt(r)?Gn().then(()=>{r=r(),f(d)}):f(d)},end(){a(),s=c=null}}}function to(n,e){const t=e.token={};function o(r,i,s,c){if(e.token!==t)return;e.resolved=c;let l=e.ctx;s!==void 0&&(l=l.slice(),l[s]=c);const a=r&&(e.current=r)(l);let u=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==i&&f&&(pe(),R(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),ge())}):e.block.d(1),a.c(),T(a,1),a.m(e.mount(),e.anchor),u=!0),e.block=a,e.blocks&&(e.blocks[i]=a),u&&yt()}if(On(n)){const r=be();if(n.then(i=>{fe(r),o(e.then,1,e.value,i),fe(null)},i=>{if(fe(r),o(e.catch,2,e.error,i),fe(null),!e.hasCatch)throw i}),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,n),!0;e.resolved=n}}function no(n,e,t){const o=e.slice(),{resolved:r}=n;n.current===n.then&&(o[n.value]=r),n.current===n.catch&&(o[n.error]=r),n.block.p(o,t)}function St(n,e){const t={},o={},r={$$scope:1};let i=n.length;for(;i--;){const s=n[i],c=e[i];if(c){for(const l in s)l in c||(o[l]=1);for(const l in c)r[l]||(t[l]=c[l],r[l]=1);n[i]=c}else for(const l in s)r[l]=1}for(const s in o)s in t||(t[s]=void 0);return t}function At(n){return typeof n=="object"&&n!==null?n:{}}function ce(n,e,t){const o=n.$$.props[e];o!==void 0&&(n.$$.bound[o]=t,t(n.$$.ctx[o]))}function q(n){n&&n.c()}function j(n,e,t,o){const{fragment:r,on_mount:i,on_destroy:s,after_update:c}=n.$$;r&&r.m(e,t),o||de(()=>{const l=i.map(kn).filter(bt);s?s.push(...l):se(l),n.$$.on_mount=[]}),c.forEach(de)}function L(n,e){const t=n.$$;t.fragment!==null&&(se(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function oo(n,e){n.$$.dirty[0]===-1&&(Ie.push(n),Vn(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function J(n,e,t,o,r,i,s,c=[-1]){const l=Pe;fe(n);const a=n.$$={fragment:null,ctx:null,props:i,update:N,not_equal:r,bound:$t(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:$t(),dirty:c,skip_bound:!1,root:e.target||l.$$.root};s&&s(a.root);let u=!1;if(a.ctx=t?t(n,e.props||{},(f,d,...h)=>{const _=h.length?h[0]:d;return a.ctx&&r(a.ctx[f],a.ctx[f]=_)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](_),u&&oo(n,f)),d}):[],a.update(),u=!0,se(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){const f=Wn(e.target);a.fragment&&a.fragment.l(f),f.forEach(C)}else a.fragment&&a.fragment.c();e.intro&&T(n.$$.fragment),j(n,e.target,e.anchor,e.customElement),yt()}fe(l)}class V{$destroy(){L(this,1),this.$destroy=N}$on(e,t){const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(t),()=>{const r=o.indexOf(t);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!An(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class ve extends Error{constructor(e,t){const o=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class vt extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Te extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ro extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class io extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class so extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class lo extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class co extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=o}}class Pn{constructor(e,t,o){this.statusCode=e,this.statusText=t,this.content=o}}class Ct{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var b;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(b||(b={}));class Re{constructor(){}log(e,t){}}Re.instance=new Re;const ao="6.0.7";class X{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,o){if(!(e in t))throw new Error(`Unknown ${o} value: ${e}.`)}}class Y{static get isBrowser(){return typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return typeof self=="object"&&"importScripts"in self}static get isReactNative(){return typeof window=="object"&&typeof window.document=="undefined"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function $e(n,e){let t="";return Et(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${uo(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function uo(n){const e=new Uint8Array(n);let t="";return e.forEach(o=>{t+=`0x${o<16?"0":""}${o.toString(16)} `}),t.substr(0,t.length-1)}function Et(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Tn(n,e,t,o,r,i,s){let c={};if(r){const d=await r();d&&(c={Authorization:`Bearer ${d}`})}const[l,a]=Ce();c[l]=a,n.log(b.Trace,`(${e} transport) sending data. ${$e(i,s.logMessageContent)}.`);const u=Et(i)?"arraybuffer":"text",f=await t.post(o,{content:i,headers:{...c,...s.headers},responseType:u,timeout:s.timeout,withCredentials:s.withCredentials});n.log(b.Trace,`(${e} transport) request complete. Response status: ${f.statusCode}.`)}function fo(n){return n===void 0?new Je(b.Information):n===null?Re.instance:n.log!==void 0?n:new Je(n)}class ho{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class Je{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const o=`[${new Date().toISOString()}] ${b[e]}: ${t}`;switch(e){case b.Critical:case b.Error:this.out.error(o);break;case b.Warning:this.out.warn(o);break;case b.Information:this.out.info(o);break;default:this.out.log(o);break}}}}function Ce(){let n="X-SignalR-User-Agent";return Y.isNode&&(n="User-Agent"),[n,po(ao,go(),mo(),_o())]}function po(n,e,t,o){let r="Microsoft SignalR/";const i=n.split(".");return r+=`${i[0]}.${i[1]}`,r+=` (${n}; `,e&&e!==""?r+=`${e}; `:r+="Unknown OS; ",r+=`${t}`,o?r+=`; ${o}`:r+="; Unknown Runtime Version",r+=")",r}function go(){if(Y.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function _o(){if(Y.isNode)return process.versions.node}function mo(){return Y.isNode?"NodeJS":"Browser"}function Mt(n){return n.stack?n.stack:n.message?n.message:`${n}`}function bo(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("could not find global")}class wo extends Ct{constructor(e){if(super(),this._logger=e,typeof fetch=="undefined"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(bo());if(typeof AbortController=="undefined"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new Te;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let o;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),o=new Te});let r=null;if(e.timeout){const l=e.timeout;r=setTimeout(()=>{t.abort(),this._logger.log(b.Warning,"Timeout from HTTP request."),o=new vt},l)}let i;try{i=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(l){throw o||(this._logger.log(b.Warning,`Error from HTTP request. ${l}.`),l)}finally{r&&clearTimeout(r),e.abortSignal&&(e.abortSignal.onabort=null)}if(!i.ok){const l=await Nt(i,"text");throw new ve(l||i.statusText,i.status)}const c=await Nt(i,e.responseType);return new Pn(i.status,i.statusText,c)}getCookieString(e){let t="";return Y.isNode&&this._jar&&this._jar.getCookies(e,(o,r)=>t=r.join("; ")),t}}function Nt(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class ko extends Ct{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Te):e.method?e.url?new Promise((t,o)=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),r.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type","text/plain;charset=UTF-8");const i=e.headers;i&&Object.keys(i).forEach(s=>{r.setRequestHeader(s,i[s])}),e.responseType&&(r.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{r.abort(),o(new Te)}),e.timeout&&(r.timeout=e.timeout),r.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new Pn(r.status,r.statusText,r.response||r.responseText)):o(new ve(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(b.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),o(new ve(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(b.Warning,"Timeout from HTTP request."),o(new vt)},r.send(e.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class yo extends Ct{constructor(e){if(super(),typeof fetch!="undefined"||Y.isNode)this._httpClient=new wo(e);else if(typeof XMLHttpRequest!="undefined")this._httpClient=new ko(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Te):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class ne{static write(e){return`${e}${ne.RecordSeparator}`}static parse(e){if(e[e.length-1]!==ne.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(ne.RecordSeparator);return t.pop(),t}}ne.RecordSeparatorCode=30;ne.RecordSeparator=String.fromCharCode(ne.RecordSeparatorCode);class So{writeHandshakeRequest(e){return ne.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,o;if(Et(e)){const c=new Uint8Array(e),l=c.indexOf(ne.RecordSeparatorCode);if(l===-1)throw new Error("Message is incomplete.");const a=l+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,a))),o=c.byteLength>a?c.slice(a).buffer:null}else{const c=e,l=c.indexOf(ne.RecordSeparator);if(l===-1)throw new Error("Message is incomplete.");const a=l+1;t=c.substring(0,a),o=c.length>a?c.substring(a):null}const r=ne.parse(t),i=JSON.parse(r[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[o,i]}}var W;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close"})(W||(W={}));class vo{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new ho(this,e)}}const Co=30*1e3,Eo=15*1e3;var U;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(U||(U={}));class It{constructor(e,t,o,r){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(b.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},X.isRequired(e,"connection"),X.isRequired(t,"logger"),X.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=Co,this.keepAliveIntervalInMilliseconds=Eo,this._logger=t,this._protocol=o,this.connection=e,this._reconnectPolicy=r,this._handshakeProtocol=new So,this.connection.onreceive=i=>this._processIncomingData(i),this.connection.onclose=i=>this._connectionClosed(i),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=U.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:W.Ping})}static create(e,t,o,r){return new It(e,t,o,r)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==U.Disconnected&&this._connectionState!==U.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==U.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=U.Connecting,this._logger.log(b.Debug,"Starting HubConnection.");try{await this._startInternal(),Y.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=U.Connected,this._connectionStarted=!0,this._logger.log(b.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=U.Disconnected,this._logger.log(b.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,o)=>{this._handshakeResolver=t,this._handshakeRejecter=o});await this.connection.start(this._protocol.transferFormat);try{const t={protocol:this._protocol.name,version:this._protocol.version};if(this._logger.log(b.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(b.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError}catch(t){throw this._logger.log(b.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){return this._connectionState===U.Disconnected?(this._logger.log(b.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===U.Disconnecting?(this._logger.log(b.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=U.Disconnecting,this._logger.log(b.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(b.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,r);let s;const c=new vo;return c.cancelCallback=()=>{const l=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],s.then(()=>this._sendWithProtocol(l))},this._callbacks[i.invocationId]=(l,a)=>{if(a){c.error(a);return}else l&&(l.type===W.Completion?l.error?c.error(new Error(l.error)):c.complete():c.next(l.item))},s=this._sendWithProtocol(i).catch(l=>{c.error(l),delete this._callbacks[i.invocationId]}),this._launchStreams(o,s),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,r));return this._launchStreams(o,i),i}invoke(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,r);return new Promise((c,l)=>{this._callbacks[i.invocationId]=(u,f)=>{if(f){l(f);return}else u&&(u.type===W.Completion?u.error?l(new Error(u.error)):c(u.result):l(new Error(`Unexpected message type: ${u.type}`)))};const a=this._sendWithProtocol(i).catch(u=>{l(u),delete this._callbacks[i.invocationId]});this._launchStreams(o,a)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const o=this._methods[e];if(!!o)if(t){const r=o.indexOf(t);r!==-1&&(o.splice(r,1),o.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const o of t)switch(o.type){case W.Invocation:this._invokeClientMethod(o);break;case W.StreamItem:case W.Completion:{const r=this._callbacks[o.invocationId];if(r){o.type===W.Completion&&delete this._callbacks[o.invocationId];try{r(o)}catch(i){this._logger.log(b.Error,`Stream callback threw error: ${Mt(i)}`)}}break}case W.Ping:break;case W.Close:{this._logger.log(b.Information,"Close message received from server.");const r=o.error?new Error("Server returned an error on close: "+o.error):void 0;o.allowReconnect===!0?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}default:this._logger.log(b.Warning,`Invalid message type: ${o.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(r){const i="Error parsing handshake response: "+r;this._logger.log(b.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}if(t.error){const r="Server returned handshake error: "+t.error;this._logger.log(b.Error,r);const i=new Error(r);throw this._handshakeRejecter(i),i}else this._logger.log(b.Debug,"Server handshake complete.");return this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===U.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(e){const t=this._methods[e.target.toLowerCase()];if(t){try{t.forEach(o=>o.apply(this,e.arguments))}catch(o){this._logger.log(b.Error,`A callback for the method ${e.target.toLowerCase()} threw error '${o}'.`)}if(e.invocationId){const o="Server requested a response, which is not supported in this version of the client.";this._logger.log(b.Error,o),this._stopPromise=this._stopInternal(new Error(o))}}else this._logger.log(b.Warning,`No client method with the name '${e.target}' found.`)}_connectionClosed(e){this._logger.log(b.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new Error("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===U.Disconnecting?this._completeClose(e):this._connectionState===U.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===U.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=U.Disconnected,this._connectionStarted=!1,Y.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(b.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let o=0,r=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(o++,0,r);if(i===null){this._logger.log(b.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=U.Reconnecting,e?this._logger.log(b.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(b.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(b.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==U.Reconnecting){this._logger.log(b.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;i!==null;){if(this._logger.log(b.Information,`Reconnect attempt number ${o} will start in ${i} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==U.Reconnecting){this._logger.log(b.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=U.Connected,this._logger.log(b.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(b.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(b.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==U.Reconnecting){this._logger.log(b.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===U.Disconnecting&&this._completeClose();return}r=s instanceof Error?s:new Error(s.toString()),i=this._getNextRetryDelay(o++,Date.now()-t,r)}}this._logger.log(b.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:o})}catch(r){return this._logger.log(b.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${r}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(o=>{const r=t[o];try{r(null,e)}catch(i){this._logger.log(b.Error,`Stream 'error' callback called with '${e}' threw error: ${Mt(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,o,r){if(o)return r.length!==0?{arguments:t,streamIds:r,target:e,type:W.Invocation}:{arguments:t,target:e,type:W.Invocation};{const i=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:i.toString(),streamIds:r,target:e,type:W.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:W.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const o in e)e[o].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:r=>{let i;r instanceof Error?i=r.message:r&&r.toString?i=r.toString():i="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,i)))},next:r=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,r)))}})}}_replaceStreamingParams(e){const t=[],o=[];for(let r=0;r<e.length;r++){const i=e[r];if(this._isObservable(i)){const s=this._invocationId;this._invocationId++,t[s]=i,o.push(s.toString()),e.splice(r,1)}}return[t,o]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,o){const r=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:r.toString(),streamIds:o,target:e,type:W.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:e,type:W.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:W.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:W.StreamItem}}_createCompletionMessage(e,t,o){return t?{error:t,invocationId:e,type:W.Completion}:{invocationId:e,result:o,type:W.Completion}}}const Io=[0,2e3,1e4,3e4,null];class zt{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Io}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class _e{}_e.Authorization="Authorization";_e.Cookie="Cookie";var F;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(F||(F={}));var G;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(G||(G={}));class Po{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class Ht{constructor(e,t,o,r){this._httpClient=e,this._accessTokenFactory=t,this._logger=o,this._pollAbort=new Po,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}async connect(e,t){if(X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,G,"transferFormat"),this._url=e,this._logger.log(b.Trace,"(LongPolling transport) Connecting."),t===G.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[o,r]=Ce(),i={[o]:r,...this._options.headers},s={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===G.Binary&&(s.responseType="arraybuffer");const c=await this._getAccessToken();this._updateHeaderToken(s,c);const l=`${e}&_=${Date.now()}`;this._logger.log(b.Trace,`(LongPolling transport) polling: ${l}.`);const a=await this._httpClient.get(l,s);a.statusCode!==200?(this._logger.log(b.Error,`(LongPolling transport) Unexpected response code: ${a.statusCode}.`),this._closeError=new ve(a.statusText||"",a.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _getAccessToken(){return this._accessTokenFactory?await this._accessTokenFactory():null}_updateHeaderToken(e,t){if(e.headers||(e.headers={}),t){e.headers[_e.Authorization]=`Bearer ${t}`;return}e.headers[_e.Authorization]&&delete e.headers[_e.Authorization]}async _poll(e,t){try{for(;this._running;){const o=await this._getAccessToken();this._updateHeaderToken(t,o);try{const r=`${e}&_=${Date.now()}`;this._logger.log(b.Trace,`(LongPolling transport) polling: ${r}.`);const i=await this._httpClient.get(r,t);i.statusCode===204?(this._logger.log(b.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):i.statusCode!==200?(this._logger.log(b.Error,`(LongPolling transport) Unexpected response code: ${i.statusCode}.`),this._closeError=new ve(i.statusText||"",i.statusCode),this._running=!1):i.content?(this._logger.log(b.Trace,`(LongPolling transport) data received. ${$e(i.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(i.content)):this._logger.log(b.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof vt?this._logger.log(b.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(b.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}}finally{this._logger.log(b.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Tn(this._logger,"LongPolling",this._httpClient,this._url,this._accessTokenFactory,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(b.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(b.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,o]=Ce();e[t]=o;const r={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials},i=await this._getAccessToken();this._updateHeaderToken(r,i),await this._httpClient.delete(this._url,r),this._logger.log(b.Trace,"(LongPolling transport) DELETE request sent.")}finally{this._logger.log(b.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(b.Trace,e),this.onclose(this._closeError)}}}class To{constructor(e,t,o,r){this._httpClient=e,this._accessTokenFactory=t,this._logger=o,this._options=r,this.onreceive=null,this.onclose=null}async connect(e,t){if(X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,G,"transferFormat"),this._logger.log(b.Trace,"(SSE transport) Connecting."),this._url=e,this._accessTokenFactory){const o=await this._accessTokenFactory();o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`)}return new Promise((o,r)=>{let i=!1;if(t!==G.Text){r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let s;if(Y.isBrowser||Y.isWebWorker)s=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),l={};l.Cookie=c;const[a,u]=Ce();l[a]=u,s=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...l,...this._options.headers}})}try{s.onmessage=c=>{if(this.onreceive)try{this._logger.log(b.Trace,`(SSE transport) data received. ${$e(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(l){this._close(l);return}},s.onerror=c=>{i?this._close():r(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},s.onopen=()=>{this._logger.log(b.Information,`SSE connected to ${this._url}`),this._eventSource=s,i=!0,o()}}catch(c){r(c);return}})}async send(e){return this._eventSource?Tn(this._logger,"SSE",this._httpClient,this._url,this._accessTokenFactory,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Ro{constructor(e,t,o,r,i,s){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}async connect(e,t){if(X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,G,"transferFormat"),this._logger.log(b.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory){const o=await this._accessTokenFactory();o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`)}return new Promise((o,r)=>{e=e.replace(/^http/,"ws");let i;const s=this._httpClient.getCookieString(e);let c=!1;if(Y.isNode){const l={},[a,u]=Ce();l[a]=u,s&&(l[_e.Cookie]=`${s}`),i=new this._webSocketConstructor(e,void 0,{headers:{...l,...this._headers}})}i||(i=new this._webSocketConstructor(e)),t===G.Binary&&(i.binaryType="arraybuffer"),i.onopen=l=>{this._logger.log(b.Information,`WebSocket connected to ${e}.`),this._webSocket=i,c=!0,o()},i.onerror=l=>{let a=null;typeof ErrorEvent!="undefined"&&l instanceof ErrorEvent?a=l.error:a="There was an error with the transport",this._logger.log(b.Information,`(WebSockets transport) ${a}.`)},i.onmessage=l=>{if(this._logger.log(b.Trace,`(WebSockets transport) data received. ${$e(l.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(l.data)}catch(a){this._close(a);return}},i.onclose=l=>{if(c)this._close(l);else{let a=null;typeof ErrorEvent!="undefined"&&l instanceof ErrorEvent?a=l.error:a="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(a))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(b.Trace,`(WebSockets transport) sending data. ${$e(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(b.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const Wt=100;class $o{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,X.isRequired(e,"url"),this._logger=fo(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let o=null,r=null;if(Y.isNode&&typeof require!="undefined"){const i=typeof __webpack_require__=="function"?__non_webpack_require__:require;o=i("ws"),r=i("eventsource")}!Y.isNode&&typeof WebSocket!="undefined"&&!t.WebSocket?t.WebSocket=WebSocket:Y.isNode&&!t.WebSocket&&o&&(t.WebSocket=o),!Y.isNode&&typeof EventSource!="undefined"&&!t.EventSource?t.EventSource=EventSource:Y.isNode&&!t.EventSource&&typeof r!="undefined"&&(t.EventSource=r),this._httpClient=t.httpClient||new yo(this._logger),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||G.Binary,X.isIn(e,G,"transferFormat"),this._logger.log(b.Debug,`Starting connection with transfer format '${G[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(b.Error,t),await this._stopPromise,Promise.reject(new Error(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(b.Error,t),Promise.reject(new Error(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Pt(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(b.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(b.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(b.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(b.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===F.WebSockets)this.transport=this._constructTransport(F.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let o=null,r=0;do{if(o=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new Error("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(t=o.url),o.accessToken){const i=o.accessToken;this._accessTokenFactory=()=>i}r++}while(o.url&&r<Wt);if(r===Wt&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,o,e)}this.transport instanceof Ht&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(b.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(o){return this._logger.log(b.Error,"Failed to start the connection: "+o),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(o)}}async _getNegotiationResponse(e){const t={};if(this._accessTokenFactory){const s=await this._accessTokenFactory();s&&(t[_e.Authorization]=`Bearer ${s}`)}const[o,r]=Ce();t[o]=r;const i=this._resolveNegotiateUrl(e);this._logger.log(b.Debug,`Sending negotiation request: ${i}.`);try{const s=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));const c=JSON.parse(s.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c}catch(s){let c="Failed to complete negotiation with the server: "+s;return s instanceof ve&&s.statusCode===404&&(c=c+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(b.Error,c),Promise.reject(new lo(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,o,r){let i=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(t)){this._logger.log(b.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,r),this.connectionId=o.connectionId;return}const s=[],c=o.availableTransports||[];let l=o;for(const a of c){const u=this._resolveTransportOrError(a,t,r);if(u instanceof Error)s.push(`${a.transport} failed:`),s.push(u);else if(this._isITransport(u)){if(this.transport=u,!l){try{l=await this._getNegotiationResponse(e)}catch(f){return Promise.reject(f)}i=this._createConnectUrl(e,l.connectionToken)}try{await this._startTransport(i,r),this.connectionId=l.connectionId;return}catch(f){if(this._logger.log(b.Error,`Failed to start the transport '${a.transport}': ${f}`),l=void 0,s.push(new so(`${a.transport} failed: ${f}`,F[a.transport])),this._connectionState!=="Connecting"){const d="Failed to select transport before stop() was called.";return this._logger.log(b.Debug,d),Promise.reject(new Error(d))}}}}return s.length>0?Promise.reject(new co(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case F.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ro(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case F.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new To(this._httpClient,this._accessTokenFactory,this._logger,this._options);case F.LongPolling:return new Ht(this._httpClient,this._accessTokenFactory,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(e,t)}_resolveTransportOrError(e,t,o){const r=F[e.transport];if(r==null)return this._logger.log(b.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Do(t,r))if(e.transferFormats.map(s=>G[s]).indexOf(o)>=0){if(r===F.WebSockets&&!this._options.WebSocket||r===F.ServerSentEvents&&!this._options.EventSource)return this._logger.log(b.Debug,`Skipping transport '${F[r]}' because it is not supported in your environment.'`),new ro(`'${F[r]}' is not supported in your environment.`,r);this._logger.log(b.Debug,`Selecting transport '${F[r]}'.`);try{return this._constructTransport(r)}catch(s){return s}}else return this._logger.log(b.Debug,`Skipping transport '${F[r]}' because it does not support the requested transfer format '${G[o]}'.`),new Error(`'${F[r]}' does not support ${G[o]}.`);else return this._logger.log(b.Debug,`Skipping transport '${F[r]}' because it was disabled by the client.`),new io(`'${F[r]}' is disabled by the client.`,r)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(b.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(b.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(b.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(b.Error,`Connection disconnected with error '${e}'.`):this._logger.log(b.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(b.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(b.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Y.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(b.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=e.indexOf("?");let o=e.substring(0,t===-1?e.length:t);return o[o.length-1]!=="/"&&(o+="/"),o+="negotiate",o+=t===-1?"":e.substring(t),o.indexOf("negotiateVersion")===-1&&(o+=t===-1?"?":"&",o+="negotiateVersion="+this._negotiateVersion),o}}function Do(n,e){return!n||(e&n)!==0}class Pt{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new je,this._transportResult=new je,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new je),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new je;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):Pt._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(o){e.reject(o)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,s)=>i+s),o=new Uint8Array(t);let r=0;for(const i of e)o.set(new Uint8Array(i),r),r+=i.byteLength;return o.buffer}}class je{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const xo="json";class Oo{constructor(){this.name=xo,this.version=1,this.transferFormat=G.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Re.instance);const o=ne.parse(e),r=[];for(const i of o){const s=JSON.parse(i);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case W.Invocation:this._isInvocationMessage(s);break;case W.StreamItem:this._isStreamItemMessage(s);break;case W.Completion:this._isCompletionMessage(s);break;case W.Ping:break;case W.Close:break;default:t.log(b.Information,"Unknown message type '"+s.type+"' ignored.");continue}r.push(s)}return r}writeMessage(e){return ne.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const Ao={trace:b.Trace,debug:b.Debug,info:b.Information,information:b.Information,warn:b.Warning,warning:b.Warning,error:b.Error,critical:b.Critical,none:b.None};function Mo(n){const e=Ao[n.toLowerCase()];if(typeof e!="undefined")return e;throw new Error(`Unknown log level: ${n}`)}class No{configureLogging(e){if(X.isRequired(e,"logging"),zo(e))this.logger=e;else if(typeof e=="string"){const t=Mo(e);this.logger=new Je(t)}else this.logger=new Je(e);return this}withUrl(e,t){return X.isRequired(e,"url"),X.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return X.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new zt(e):this.reconnectPolicy=e:this.reconnectPolicy=new zt,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new $o(this.url,e);return It.create(t,this.logger||Re.instance,this.protocol||new Oo,this.reconnectPolicy)}}function zo(n){return n.log!==void 0}const we=[];function Ho(n,e){return{subscribe:oe(n,e).subscribe}}function oe(n,e=N){let t;const o=new Set;function r(c){if(K(n,c)&&(n=c,t)){const l=!we.length;for(const a of o)a[1](),we.push(a,n);if(l){for(let a=0;a<we.length;a+=2)we[a][0](we[a+1]);we.length=0}}}function i(c){r(c(n))}function s(c,l=N){const a=[c,l];return o.add(a),o.size===1&&(t=e(r)||N),c(n),()=>{o.delete(a),o.size===0&&(t(),t=null)}}return{set:r,update:i,subscribe:s}}function Wo(n,e,t){const o=!Array.isArray(n),r=o?[n]:n,i=e.length<2;return Ho(t,s=>{let c=!1;const l=[];let a=0,u=N;const f=()=>{if(a)return;u();const h=e(o?l[0]:l,s);i?s(h):u=bt(h)?h:N},d=r.map((h,_)=>yn(h,k=>{l[_]=k,a&=~(1<<_),c&&f()},()=>{a|=1<<_}));return c=!0,f(),function(){se(d),u()}})}const Ve={},Ze={};function lt(n){return{...n.location,state:n.history.state,key:n.history.state&&n.history.state.key||"initial"}}function jo(n,e){const t=[];let o=lt(n);return{get location(){return o},listen(r){t.push(r);const i=()=>{o=lt(n),r({location:o,action:"POP"})};return n.addEventListener("popstate",i),()=>{n.removeEventListener("popstate",i);const s=t.indexOf(r);t.splice(s,1)}},navigate(r,{state:i,replace:s=!1}={}){i={...i,key:Date.now()+""};try{s?n.history.replaceState(i,null,r):n.history.pushState(i,null,r)}catch{n.location[s?"replace":"assign"](r)}o=lt(n),t.forEach(c=>c({location:o,action:"PUSH"}))}}}function Lo(n="/"){let e=0;const t=[{pathname:n,search:""}],o=[];return{get location(){return t[e]},addEventListener(r,i){},removeEventListener(r,i){},history:{get entries(){return t},get index(){return e},get state(){return o[e]},pushState(r,i,s){const[c,l=""]=s.split("?");e++,t.push({pathname:c,search:l}),o.push(r)},replaceState(r,i,s){const[c,l=""]=s.split("?");t[e]={pathname:c,search:l},o[e]=r}}}}const Uo=Boolean(typeof window!="undefined"&&window.document&&window.document.createElement),ht=jo(Uo?window:Lo()),{navigate:qo}=ht,Rn=/^:(.+)/,jt=4,Bo=3,Fo=2,Xo=1,Qo=1;function dt(n,e){return n.substr(0,e.length)===e}function Ko(n){return n===""}function Yo(n){return Rn.test(n)}function $n(n){return n[0]==="*"}function De(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function ct(n){return n.replace(/(^\/+|\/+$)/g,"")}function Jo(n,e){const t=n.default?0:De(n.path).reduce((o,r)=>(o+=jt,Ko(r)?o+=Qo:Yo(r)?o+=Fo:$n(r)?o-=jt+Xo:o+=Bo,o),0);return{route:n,score:t,index:e}}function Vo(n){return n.map(Jo).sort((e,t)=>e.score<t.score?1:e.score>t.score?-1:e.index-t.index)}function Dn(n,e){let t,o;const[r]=e.split("?"),i=De(r),s=i[0]==="",c=Vo(n);for(let l=0,a=c.length;l<a;l++){const u=c[l].route;let f=!1;if(u.default){o={route:u,params:{},uri:e};continue}const d=De(u.path),h={},_=Math.max(i.length,d.length);let k=0;for(;k<_;k++){const g=d[k],m=i[k];if(g!==void 0&&$n(g)){const v=g==="*"?"*":g.slice(1);h[v]=i.slice(k).map(decodeURIComponent).join("/");break}if(m===void 0){f=!0;break}let p=Rn.exec(g);if(p&&!s){const v=decodeURIComponent(m);h[p[1]]=v}else if(g!==m){f=!0;break}}if(!f){t={route:u,params:h,uri:"/"+i.slice(0,k).join("/")};break}}return t||o||null}function Zo(n,e){return Dn([n],e)}function at(n,e){return n+(e?`?${e}`:"")}function Go(n,e){if(dt(n,"/"))return n;const[t,o]=n.split("?"),[r]=e.split("?"),i=De(t),s=De(r);if(i[0]==="")return at(r,o);if(!dt(i[0],".")){const a=s.concat(i).join("/");return at((r==="/"?"":"/")+a,o)}const c=s.concat(i),l=[];return c.forEach(a=>{a===".."?l.pop():a!=="."&&l.push(a)}),at("/"+l.join("/"),o)}function Lt(n,e){return`${ct(e==="/"?n:`${ct(n)}/${ct(e)}`)}/`}function er(n){return!n.defaultPrevented&&n.button===0&&!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function tr(n){let e;const t=n[9].default,o=Oe(t,n,n[8],null);return{c(){o&&o.c()},m(r,i){o&&o.m(r,i),e=!0},p(r,[i]){o&&o.p&&(!e||i&256)&&Me(o,t,r,r[8],e?Ae(t,r[8],i,null):Ne(r[8]),null)},i(r){e||(T(o,r),e=!0)},o(r){R(o,r),e=!1},d(r){o&&o.d(r)}}}function nr(n,e,t){let o,r,i,{$$slots:s={},$$scope:c}=e,{basepath:l="/"}=e,{url:a=null}=e;const u=Se(Ve),f=Se(Ze),d=oe([]);H(n,d,w=>t(6,r=w));const h=oe(null);let _=!1;const k=u||oe(a?{pathname:a}:ht.location);H(n,k,w=>t(5,o=w));const g=f?f.routerBase:oe({path:l,uri:l});H(n,g,w=>t(7,i=w));const m=Wo([g,h],([w,O])=>{if(O===null)return w;const{path:P}=w,{route:$,uri:nt}=O;return{path:$.default?P:$.path.replace(/\*.*$/,""),uri:nt}});function p(w){const{path:O}=i;let{path:P}=w;if(w._path=P,w.path=Lt(O,P),typeof window=="undefined"){if(_)return;const $=Zo(w,o.pathname);$&&(h.set($),_=!0)}else d.update($=>($.push(w),$))}function v(w){d.update(O=>{const P=O.indexOf(w);return O.splice(P,1),O})}return u||(Xn(()=>ht.listen(O=>{k.set(O.location)})),xt(Ve,k)),xt(Ze,{activeRoute:h,base:g,routerBase:m,registerRoute:p,unregisterRoute:v}),n.$$set=w=>{"basepath"in w&&t(3,l=w.basepath),"url"in w&&t(4,a=w.url),"$$scope"in w&&t(8,c=w.$$scope)},n.$$.update=()=>{if(n.$$.dirty&128){const{path:w}=i;d.update(O=>(O.forEach(P=>P.path=Lt(w,P._path)),O))}if(n.$$.dirty&96){const w=Dn(r,o.pathname);h.set(w)}},[d,k,g,l,a,o,r,i,c,s]}class or extends V{constructor(e){super(),J(this,e,nr,tr,K,{basepath:3,url:4})}}const rr=n=>({params:n&4,location:n&16}),Ut=n=>({params:n[2],location:n[4]});function qt(n){let e,t,o,r;const i=[sr,ir],s=[];function c(l,a){return l[0]!==null?0:1}return e=c(n),t=s[e]=i[e](n),{c(){t.c(),o=ee()},m(l,a){s[e].m(l,a),E(l,o,a),r=!0},p(l,a){let u=e;e=c(l),e===u?s[e].p(l,a):(pe(),R(s[u],1,1,()=>{s[u]=null}),ge(),t=s[e],t?t.p(l,a):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(o.parentNode,o))},i(l){r||(T(t),r=!0)},o(l){R(t),r=!1},d(l){s[e].d(l),l&&C(o)}}}function ir(n){let e;const t=n[10].default,o=Oe(t,n,n[9],Ut);return{c(){o&&o.c()},m(r,i){o&&o.m(r,i),e=!0},p(r,i){o&&o.p&&(!e||i&532)&&Me(o,t,r,r[9],e?Ae(t,r[9],i,rr):Ne(r[9]),Ut)},i(r){e||(T(o,r),e=!0)},o(r){R(o,r),e=!1},d(r){o&&o.d(r)}}}function sr(n){let e,t,o;const r=[{location:n[4]},n[2],n[3]];var i=n[0];function s(c){let l={};for(let a=0;a<r.length;a+=1)l=ae(l,r[a]);return{props:l}}return i&&(e=new i(s())),{c(){e&&q(e.$$.fragment),t=ee()},m(c,l){e&&j(e,c,l),E(c,t,l),o=!0},p(c,l){const a=l&28?St(r,[l&16&&{location:c[4]},l&4&&At(c[2]),l&8&&At(c[3])]):{};if(i!==(i=c[0])){if(e){pe();const u=e;R(u.$$.fragment,1,0,()=>{L(u,1)}),ge()}i?(e=new i(s()),q(e.$$.fragment),T(e.$$.fragment,1),j(e,t.parentNode,t)):e=null}else i&&e.$set(a)},i(c){o||(e&&T(e.$$.fragment,c),o=!0)},o(c){e&&R(e.$$.fragment,c),o=!1},d(c){c&&C(t),e&&L(e,c)}}}function lr(n){let e,t,o=n[1]!==null&&n[1].route===n[7]&&qt(n);return{c(){o&&o.c(),e=ee()},m(r,i){o&&o.m(r,i),E(r,e,i),t=!0},p(r,[i]){r[1]!==null&&r[1].route===r[7]?o?(o.p(r,i),i&2&&T(o,1)):(o=qt(r),o.c(),T(o,1),o.m(e.parentNode,e)):o&&(pe(),R(o,1,1,()=>{o=null}),ge())},i(r){t||(T(o),t=!0)},o(r){R(o),t=!1},d(r){o&&o.d(r),r&&C(e)}}}function cr(n,e,t){let o,r,{$$slots:i={},$$scope:s}=e,{path:c=""}=e,{component:l=null}=e;const{registerRoute:a,unregisterRoute:u,activeRoute:f}=Se(Ze);H(n,f,g=>t(1,o=g));const d=Se(Ve);H(n,d,g=>t(4,r=g));const h={path:c,default:c===""};let _={},k={};return a(h),typeof window!="undefined"&&Kn(()=>{u(h)}),n.$$set=g=>{t(13,e=ae(ae({},e),Fe(g))),"path"in g&&t(8,c=g.path),"component"in g&&t(0,l=g.component),"$$scope"in g&&t(9,s=g.$$scope)},n.$$.update=()=>{n.$$.dirty&2&&o&&o.route===h&&t(2,_=o.params);{const{path:g,component:m,...p}=e;t(3,k=p)}},e=Fe(e),[l,o,_,k,r,f,d,h,c,s,i]}class Le extends V{constructor(e){super(),J(this,e,cr,lr,K,{path:8,component:0})}}function ar(n){let e,t,o,r;const i=n[16].default,s=Oe(i,n,n[15],null);let c=[{href:n[0]},{"aria-current":n[2]},n[1],n[6]],l={};for(let a=0;a<c.length;a+=1)l=ae(l,c[a]);return{c(){e=I("a"),s&&s.c(),Qe(e,l)},m(a,u){E(a,e,u),s&&s.m(e,null),t=!0,o||(r=A(e,"click",n[5]),o=!0)},p(a,[u]){s&&s.p&&(!t||u&32768)&&Me(s,i,a,a[15],t?Ae(i,a[15],u,null):Ne(a[15]),null),Qe(e,l=St(c,[(!t||u&1)&&{href:a[0]},(!t||u&4)&&{"aria-current":a[2]},u&2&&a[1],u&64&&a[6]]))},i(a){t||(T(s,a),t=!0)},o(a){R(s,a),t=!1},d(a){a&&C(e),s&&s.d(a),o=!1,r()}}}function ur(n,e,t){let o;const r=["to","replace","state","getProps"];let i=Xe(e,r),s,c,{$$slots:l={},$$scope:a}=e,{to:u="#"}=e,{replace:f=!1}=e,{state:d={}}=e,{getProps:h=()=>({})}=e;const{base:_}=Se(Ze);H(n,_,P=>t(14,c=P));const k=Se(Ve);H(n,k,P=>t(13,s=P));const g=kt();let m,p,v,w;function O(P){if(g("click",P),er(P)){P.preventDefault();const $=s.pathname===m||f;qo(m,{state:d,replace:$})}}return n.$$set=P=>{e=ae(ae({},e),Fe(P)),t(6,i=Xe(e,r)),"to"in P&&t(7,u=P.to),"replace"in P&&t(8,f=P.replace),"state"in P&&t(9,d=P.state),"getProps"in P&&t(10,h=P.getProps),"$$scope"in P&&t(15,a=P.$$scope)},n.$$.update=()=>{n.$$.dirty&16512&&t(0,m=u==="/"?c.uri:Go(u,c.uri)),n.$$.dirty&8193&&t(11,p=dt(s.pathname,m)),n.$$.dirty&8193&&t(12,v=m===s.pathname),n.$$.dirty&4096&&t(2,o=v?"page":void 0),n.$$.dirty&15361&&t(1,w=h({location:s,href:m,isPartiallyCurrent:p,isCurrent:v}))},[m,w,o,_,k,O,i,u,f,d,h,p,v,s,c,a,l]}class Ue extends V{constructor(e){super(),J(this,e,ur,ar,K,{to:7,replace:8,state:9,getProps:10})}}const pt=oe([]),gt=oe([]),_t=oe([]),Ge=oe({}),et=oe(),Z=oe({id:0,name:"",x:0,y:0}),ie=oe({map:null,creatures:null});class fr extends V{constructor(e){super(),J(this,e,null,null,K,{})}}class hr extends V{constructor(e){super(),J(this,e,null,null,K,{})}}class dr extends V{constructor(e){super(),J(this,e,null,null,K,{})}}let xe=[{name:"W4",sides:4,values:[],number:0,modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W6",sides:6,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W8",sides:8,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W10",sides:10,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W12",sides:12,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W20",sides:20,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"},{number:0,name:"W100",sides:100,values:[],modifier:0,image:"https://i.imgur.com/XyqQZQs.png"}];function mt(n){return n.forEach(e=>{e.values=[],e.total=0;for(var t=0;t<e.number;t++){const o=Math.floor(Math.random()*e.sides)+1;e.values.push(o),e.total+=o}}),n}function Bt(n,e,t){const o=n.slice();return o[10]=e[t],o}function Ft(n,e,t){const o=n.slice();return o[17]=e[t],o[19]=t,o}function Xt(n,e,t){const o=n.slice();return o[10]=e[t],o[11]=e,o[12]=t,o}function Qt(n,e,t){const o=n.slice();return o[10]=e[t],o}function pr(n){let e,t,o,r;return{c(){e=I("div"),t=I("button"),t.textContent="W\xFCrfel",S(t,"class","border-2 rounded-xl p-2 m-2 bg-black text-white"),S(e,"class","m-0 fixed bottom-4 right-4 flex items-center")},m(i,s){E(i,e,s),y(e,t),o||(r=A(t,"click",n[9]),o=!0)},p:N,d(i){i&&C(e),o=!1,r()}}}function gr(n){let e,t,o,r,i;function s(a,u){return a[1]?_r:mr}let c=s(n),l=c(n);return{c(){e=I("div"),t=x(),o=I("div"),l.c(),S(e,"class","absolute left-0 top-0 bg-black opacity-50 z-30 h-screen w-screen"),S(o,"class","m-0 absolute bottom-4 right-4 flex items-center z-50 portrait:flex-col")},m(a,u){E(a,e,u),E(a,t,u),E(a,o,u),l.m(o,null),r||(i=A(e,"click",n[6]),r=!0)},p(a,u){c===(c=s(a))&&l?l.p(a,u):(l.d(1),l=c(a),l&&(l.c(),l.m(o,null)))},d(a){a&&C(e),a&&C(t),a&&C(o),l.d(),r=!1,i()}}}function _r(n){let e,t,o,r,i,s=n[0],c=[];for(let l=0;l<s.length;l+=1)c[l]=Jt(Bt(n,s,l));return{c(){e=I("div");for(let l=0;l<c.length;l+=1)c[l].c();t=x(),o=I("button"),o.textContent="X",S(o,"class","border-2 rounded-full p-1 text-center bg-slate-200"),S(e,"class","border-2 rounded-xl p-4 m-4 flex bg-black portrait:flex-col")},m(l,a){E(l,e,a);for(let u=0;u<c.length;u+=1)c[u].m(e,null);y(e,t),y(e,o),r||(i=A(o,"click",n[4]),r=!0)},p(l,a){if(a&1){s=l[0];let u;for(u=0;u<s.length;u+=1){const f=Bt(l,s,u);c[u]?c[u].p(f,a):(c[u]=Jt(f),c[u].c(),c[u].m(e,t))}for(;u<c.length;u+=1)c[u].d(1);c.length=s.length}},d(l){l&&C(e),ue(c,l),r=!1,i()}}}function mr(n){let e,t,o,r=xe,i=[];for(let c=0;c<r.length;c+=1)i[c]=Vt(Qt(n,r,c));let s=n[0].length>0&&Zt(n);return{c(){e=I("div");for(let c=0;c<i.length;c+=1)i[c].c();t=x(),s&&s.c(),o=ee(),S(e,"class","border-2 rounded-xl p-2 m-2 flex bg-black portrait:flex-col")},m(c,l){E(c,e,l);for(let a=0;a<i.length;a+=1)i[a].m(e,null);E(c,t,l),s&&s.m(c,l),E(c,o,l)},p(c,l){if(l&32){r=xe;let a;for(a=0;a<r.length;a+=1){const u=Qt(c,r,a);i[a]?i[a].p(u,l):(i[a]=Vt(u),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=r.length}c[0].length>0?s?s.p(c,l):(s=Zt(c),s.c(),s.m(o.parentNode,o)):s&&(s.d(1),s=null)},d(c){c&&C(e),ue(i,c),c&&C(t),s&&s.d(c),c&&C(o)}}}function Kt(n){let e;return{c(){e=D("+")},m(t,o){E(t,e,o)},d(t){t&&C(e)}}}function Yt(n){let e=n[17]+"",t,o,r,i=n[19]<n[10].values.length-1&&Kt();return{c(){t=D(e),o=x(),i&&i.c(),r=ee()},m(s,c){E(s,t,c),E(s,o,c),i&&i.m(s,c),E(s,r,c)},p(s,c){c&1&&e!==(e=s[17]+"")&&Q(t,e),s[19]<s[10].values.length-1?i||(i=Kt(),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},d(s){s&&C(t),s&&C(o),i&&i.d(s),s&&C(r)}}}function br(n){let e=n[10].modifier+"",t;return{c(){t=D(e)},m(o,r){E(o,t,r)},p(o,r){r&1&&e!==(e=o[10].modifier+"")&&Q(t,e)},d(o){o&&C(t)}}}function wr(n){let e,t=n[10].modifier+"",o;return{c(){e=D("+ "),o=D(t)},m(r,i){E(r,e,i),E(r,o,i)},p(r,i){i&1&&t!==(t=r[10].modifier+"")&&Q(o,t)},d(r){r&&C(e),r&&C(o)}}}function Jt(n){let e,t,o=n[10].name+"",r,i,s,c,l,a,u,f=n[10].total+n[10].modifier+"",d,h=n[10].values,_=[];for(let p=0;p<h.length;p+=1)_[p]=Yt(Ft(n,h,p));function k(p,v){if(p[10].modifier>0)return wr;if(p[10].modifier<0)return br}let g=k(n),m=g&&g(n);return{c(){e=I("div"),t=I("div"),r=D(o),i=x(),s=I("div");for(let p=0;p<_.length;p+=1)_[p].c();c=x(),m&&m.c(),l=x(),a=I("div"),u=D("= "),d=D(f),S(t,"class","pr-4"),S(s,"class","text-2xl"),S(a,"class","text-4xl"),S(e,"class","border-2 rounded-lg h-16 flex justify-center items-center text-white pl-2 pr-2")},m(p,v){E(p,e,v),y(e,t),y(t,r),y(e,i),y(e,s);for(let w=0;w<_.length;w+=1)_[w].m(s,null);y(s,c),m&&m.m(s,null),y(e,l),y(e,a),y(a,u),y(a,d)},p(p,v){if(v&1&&o!==(o=p[10].name+"")&&Q(r,o),v&1){h=p[10].values;let w;for(w=0;w<h.length;w+=1){const O=Ft(p,h,w);_[w]?_[w].p(O,v):(_[w]=Yt(O),_[w].c(),_[w].m(s,c))}for(;w<_.length;w+=1)_[w].d(1);_.length=h.length}g===(g=k(p))&&m?m.p(p,v):(m&&m.d(1),m=g&&g(p),m&&(m.c(),m.m(s,null))),v&1&&f!==(f=p[10].total+p[10].modifier+"")&&Q(d,f)},d(p){p&&C(e),ue(_,p),m&&m.d()}}}function Vt(n){let e,t=n[10].name+"",o,r,i;function s(){return n[7](n[10])}return{c(){e=I("div"),o=D(t),S(e,"class","border-2 m-1 bg-white rounded-full w-16 h-16 grid place-items-center")},m(c,l){E(c,e,l),y(e,o),r||(i=A(e,"click",s),r=!0)},p(c,l){n=c},d(c){c&&C(e),r=!1,i()}}}function Zt(n){let e,t,o,r,i,s=n[0],c=[];for(let l=0;l<s.length;l+=1)c[l]=Gt(Xt(n,s,l));return{c(){e=I("div");for(let l=0;l<c.length;l+=1)c[l].c();t=x(),o=I("button"),o.textContent="Roll",S(o,"class","border-2 rounded-lg w-16 h-16 text-center bg-slate-200"),S(e,"class","border-2 rounded-xl p-2 m-2 flex bg-slate-200")},m(l,a){E(l,e,a);for(let u=0;u<c.length;u+=1)c[u].m(e,null);y(e,t),y(e,o),r||(i=A(o,"click",n[3]),r=!0)},p(l,a){if(a&1){s=l[0];let u;for(u=0;u<s.length;u+=1){const f=Xt(l,s,u);c[u]?c[u].p(f,a):(c[u]=Gt(f),c[u].c(),c[u].m(e,t))}for(;u<c.length;u+=1)c[u].d(1);c.length=s.length}},d(l){l&&C(e),ue(c,l),r=!1,i()}}}function Gt(n){let e,t=n[10].number+"",o,r=n[10].name+"",i,s,c,l,a,u,f;function d(){n[8].call(a,n[11],n[12])}return{c(){e=I("div"),o=D(t),i=D(r),s=x(),c=I("br"),l=x(),a=I("input"),S(a,"type","number"),S(a,"class","w-10 bg-slate-100 text-center"),S(e,"class","border-2 rounded-lg w-16 h-16 grid place-items-center")},m(h,_){E(h,e,_),y(e,o),y(e,i),y(e,s),y(e,c),y(e,l),y(e,a),ye(a,n[10].modifier),u||(f=A(a,"input",d),u=!0)},p(h,_){n=h,_&1&&t!==(t=n[10].number+"")&&Q(o,t),_&1&&r!==(r=n[10].name+"")&&Q(i,r),_&1&&tt(a.value)!==n[10].modifier&&ye(a,n[10].modifier)},d(h){h&&C(e),u=!1,f()}}}function kr(n){let e;function t(i,s){return i[2]?gr:pr}let o=t(n),r=o(n);return{c(){r.c(),e=ee()},m(i,s){r.m(i,s),E(i,e,s)},p(i,[s]){o===(o=t(i))&&r?r.p(i,s):(r.d(1),r=o(i),r&&(r.c(),r.m(e.parentNode,e)))},i:N,o:N,d(i){r.d(i),i&&C(e)}}}function yr(n,e,t){let o=[],r=!1;function i(){t(0,o=mt(o)),t(1,r=!0)}function s(){t(1,r=!1),t(0,o=[]),xe.forEach(h=>{h.values=[],h.modifier=0}),t(2,l=!1)}function c(h){const _=o.find(k=>k.name===h.name);_?_.number++:t(0,o=[...o,{...h,number:1}]),t(0,o)}let l=!1;const a=()=>t(2,l=!1),u=h=>c(h);function f(h,_){h[_].modifier=tt(this.value),t(0,o)}return[o,r,l,i,s,c,a,u,f,()=>t(2,l=!0)]}class Sr extends V{constructor(e){super(),J(this,e,yr,kr,K,{})}}function en(n,{delay:e=0,duration:t=400,easing:o=wn}={}){const r=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:o,css:i=>`opacity: ${i*r}`}}function tn(n){let e,t,o,r,i,s,c,l;const a=n[3].default,u=Oe(a,n,n[2],null);let f=[n[1],{class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white w-3/4"}],d={};for(let h=0;h<f.length;h+=1)d=ae(d,f[h]);return{c(){e=I("div"),t=I("div"),o=x(),r=I("div"),u&&u.c(),S(t,"class","fixed top-0 left-0 w-screen h-screen bg-black opacity-50"),Qe(r,d),S(e,"class","fixed top-0 left-0 w-screen h-screen z-50")},m(h,_){E(h,e,_),y(e,t),y(e,o),y(e,r),u&&u.m(r,null),s=!0,c||(l=A(t,"click",n[4]),c=!0)},p(h,_){u&&u.p&&(!s||_&4)&&Me(u,a,h,h[2],s?Ae(a,h[2],_,null):Ne(h[2]),null),Qe(r,d=St(f,[_&2&&h[1],{class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white w-3/4"}]))},i(h){s||(T(u,h),de(()=>{i||(i=Ot(e,en,{duration:200},!0)),i.run(1)}),s=!0)},o(h){R(u,h),i||(i=Ot(e,en,{duration:200},!1)),i.run(0),s=!1},d(h){h&&C(e),u&&u.d(h),h&&i&&i.end(),c=!1,l()}}}function vr(n){let e,t,o=n[0]&&tn(n);return{c(){o&&o.c(),e=ee()},m(r,i){o&&o.m(r,i),E(r,e,i),t=!0},p(r,[i]){r[0]?o?(o.p(r,i),i&1&&T(o,1)):(o=tn(r),o.c(),T(o,1),o.m(e.parentNode,e)):o&&(pe(),R(o,1,1,()=>{o=null}),ge())},i(r){t||(T(o),t=!0)},o(r){R(o),t=!1},d(r){o&&o.d(r),r&&C(e)}}}function Cr(n,e,t){const o=["isOpen"];let r=Xe(e,o),{$$slots:i={},$$scope:s}=e,{isOpen:c=!0}=e;const l=()=>t(0,c=!1);return n.$$set=a=>{e=ae(ae({},e),Fe(a)),t(1,r=Xe(e,o)),"isOpen"in a&&t(0,c=a.isOpen),"$$scope"in a&&t(2,s=a.$$scope)},[c,r,s,i,l]}class Tt extends V{constructor(e){super(),J(this,e,Cr,vr,K,{isOpen:0})}}function nn(n,e,t){const o=n.slice();return o[12]=e[t],o}function on(n){let e,t=n[12].description+"",o,r,i,s;function c(){return n[3](n[12])}return{c(){e=I("button"),o=D(t),r=I("br"),S(e,"class","p-2 border-2")},m(l,a){E(l,e,a),y(e,o),E(l,r,a),i||(s=A(e,"click",c),i=!0)},p(l,a){n=l,a&2&&t!==(t=n[12].description+"")&&Q(o,t)},d(l){l&&C(e),l&&C(r),i=!1,s()}}}function Er(n){let e,t,o,r,i,s=n[1],c=[];for(let l=0;l<s.length;l+=1)c[l]=on(nn(n,s,l));return{c(){e=I("div");for(let l=0;l<c.length;l+=1)c[l].c();t=x(),o=I("button"),o.textContent="Starten",S(o,"class","border-2 rounded-xl p-2 m-2 bg-black text-white"),S(e,"class","h-full w-full bg-white rounded-xl p-8")},m(l,a){E(l,e,a);for(let u=0;u<c.length;u+=1)c[u].m(e,null);y(e,t),y(e,o),r||(i=A(o,"click",n[4]),r=!0)},p(l,a){if(a&6){s=l[1];let u;for(u=0;u<s.length;u+=1){const f=nn(l,s,u);c[u]?c[u].p(f,a):(c[u]=on(f),c[u].c(),c[u].m(e,t))}for(;u<c.length;u+=1)c[u].d(1);c.length=s.length}},d(l){l&&C(e),ue(c,l),r=!1,i()}}}function Ir(n){let e,t,o;function r(s){n[5](s)}let i={$$slots:{default:[Er]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.isOpen=n[0]),e=new Tt({props:i}),te.push(()=>ce(e,"isOpen",r)),{c(){q(e.$$.fragment)},m(s,c){j(e,s,c),o=!0},p(s,[c]){const l={};c&32771&&(l.$$scope={dirty:c,ctx:s}),!t&&c&1&&(t=!0,l.isOpen=s[0],le(()=>t=!1)),e.$set(l)},i(s){o||(T(e.$$.fragment,s),o=!0)},o(s){R(e.$$.fragment,s),o=!1},d(s){L(e,s)}}}function Pr(n,e,t){let o,r,i,s,c,l,a;H(n,et,k=>t(6,o=k)),H(n,Ge,k=>t(7,r=k)),H(n,ie,k=>t(8,i=k)),H(n,Z,k=>t(9,s=k)),H(n,pt,k=>t(10,c=k)),H(n,gt,k=>t(11,l=k)),H(n,_t,k=>t(1,a=k));let{isOpen:u=!1}=e;async function f(k){B(ie,i.map=l.find(m=>m.id===k.mapId),i),B(ie,i.creatures=k.creatureIds.map(m=>c.find(p=>p.id===m)),i),B(Z,s=i.creatures[0],s),B(ie,i=k,i);const g={SceneId:k.id,Updated:"2000-01-01"};B(Ge,r=await fetch("/api/session",{method:"PUT",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(g)}).then(m=>m.json()),r),o.invoke("LoadScene",k.id),t(0,u=!1)}const d=k=>f(k),h=()=>t(0,u=!1);function _(k){u=k,t(0,u)}return n.$$set=k=>{"isOpen"in k&&t(0,u=k.isOpen)},[u,a,f,d,h,_]}class Tr extends V{constructor(e){super(),J(this,e,Pr,Ir,K,{isOpen:0})}}function Rr(n){let e,t,o,r,i;de(n[14]);const s=n[13].default,c=Oe(s,n,n[12],null);return{c(){e=I("section"),c&&c.c(),z(e,"left",n[0]+"px"),z(e,"top",n[1]+"px"),S(e,"class","draggable svelte-1ms01q6"),de(()=>n[15].call(e))},m(l,a){E(l,e,a),c&&c.m(e,null),t=Ln(e,n[15].bind(e)),o=!0,r||(i=[A(window,"mouseup",n[8]),A(window,"mousemove",n[7]),A(window,"touchmove",n[10]),A(window,"touchend",n[11]),A(window,"resize",n[14]),A(e,"mousedown",n[6]),A(e,"touchstart",n[9])],r=!0)},p(l,[a]){c&&c.p&&(!o||a&4096)&&Me(c,s,l,l[12],o?Ae(s,l[12],a,null):Ne(l[12]),null),(!o||a&1)&&z(e,"left",l[0]+"px"),(!o||a&2)&&z(e,"top",l[1]+"px")},i(l){o||(T(c,l),o=!0)},o(l){R(c,l),o=!1},d(l){l&&C(e),c&&c.d(l),t(),r=!1,se(i)}}}function $r(n,e,t){let{$$slots:o={},$$scope:r}=e,{left:i=0}=e,{top:s=0}=e,c=!1,l={x:0,y:0},a=0,u=0,f,d,h=0,_=0;Qn(()=>{h=u-d,_=a-f,(i>0||u>d)&&t(0,i=0),(s>0||a>f)&&t(1,s=0),i<h&&d>u&&t(0,i=h),s<_&&f>a&&t(1,s=_)});function k($){console.log("down"),c=!0}function g($){c&&(t(0,i+=$.movementX),t(1,s+=$.movementY))}function m($){c=!1}function p($){c=!0,l.x=$.touches[0].clientX,l.y=$.touches[0].clientY}function v($){t(0,i+=$.touches[0].clientX-l.x),t(1,s+=$.touches[0].clientY-l.y),l.x=$.touches[0].clientX,l.y=$.touches[0].clientY}function w(){c=!1}function O(){t(2,a=window.innerHeight),t(3,u=window.innerWidth)}function P(){d=this.clientWidth,f=this.clientHeight,t(5,d),t(4,f)}return n.$$set=$=>{"left"in $&&t(0,i=$.left),"top"in $&&t(1,s=$.top),"$$scope"in $&&t(12,r=$.$$scope)},[i,s,a,u,f,d,k,g,m,p,v,w,r,o,O,P]}class Dr extends V{constructor(e){super(),J(this,e,$r,Rr,K,{left:0,top:1})}}function rn(n,e,t){const o=n.slice();return o[14]=e[t],o}function sn(n,e,t){const o=n.slice();return o[17]=e[t],o[19]=t,o}function ln(n,e,t){const o=n.slice();return o[17]=e[t],o[19]=t,o}function cn(n){let e,t,o,r,i,s,c,l,a,u,f=Array(n[2].widthInSquares),d=[];for(let g=0;g<f.length;g+=1)d[g]=an(ln(n,f,g));let h=Array(n[2].heightInSquares),_=[];for(let g=0;g<h.length;g+=1)_[g]=un(sn(n,h,g));let k=n[7]&&fn(n);return{c(){e=me("svg"),t=me("image");for(let g=0;g<d.length;g+=1)d[g].c();s=ee();for(let g=0;g<_.length;g+=1)_[g].c();c=ee(),k&&k.c(),S(t,"href",o=n[2].imageUrl),S(t,"x","0"),S(t,"y","0"),S(t,"width",r=n[2].widthInSquares),S(t,"height",i=n[2].heightInSquares),S(e,"xmlns","http://www.w3.org/2000/svg"),S(e,"viewBox",l="0 0 "+n[2].widthInSquares+" "+n[2].heightInSquares),z(e,"width",n[3]+"px"),z(e,"height",n[5]+"px")},m(g,m){E(g,e,m),y(e,t);for(let p=0;p<d.length;p+=1)d[p].m(e,null);y(e,s);for(let p=0;p<_.length;p+=1)_[p].m(e,null);y(e,c),k&&k.m(e,null),n[12](e),a||(u=A(e,"click",n[9]),a=!0)},p(g,m){if(m&4&&o!==(o=g[2].imageUrl)&&S(t,"href",o),m&4&&r!==(r=g[2].widthInSquares)&&S(t,"width",r),m&4&&i!==(i=g[2].heightInSquares)&&S(t,"height",i),m&4){f=Array(g[2].widthInSquares);let p;for(p=0;p<f.length;p+=1){const v=ln(g,f,p);d[p]?d[p].p(v,m):(d[p]=an(v),d[p].c(),d[p].m(e,s))}for(;p<d.length;p+=1)d[p].d(1);d.length=f.length}if(m&4){h=Array(g[2].heightInSquares);let p;for(p=0;p<h.length;p+=1){const v=sn(g,h,p);_[p]?_[p].p(v,m):(_[p]=un(v),_[p].c(),_[p].m(e,c))}for(;p<_.length;p+=1)_[p].d(1);_.length=h.length}g[7]?k?k.p(g,m):(k=fn(g),k.c(),k.m(e,null)):k&&(k.d(1),k=null),m&4&&l!==(l="0 0 "+g[2].widthInSquares+" "+g[2].heightInSquares)&&S(e,"viewBox",l),m&8&&z(e,"width",g[3]+"px"),m&32&&z(e,"height",g[5]+"px")},d(g){g&&C(e),ue(d,g),ue(_,g),k&&k.d(),n[12](null),a=!1,u()}}}function an(n){let e,t;return{c(){e=me("line"),S(e,"x1",n[19]),S(e,"y1","0"),S(e,"x2",n[19]),S(e,"y2",t=n[2].heightInSquares),z(e,"stroke","rgb(255,255,255)"),z(e,"stroke-width","0.01"),z(e,"opacity",n[2].gridOpacity||1)},m(o,r){E(o,e,r)},p(o,r){r&4&&t!==(t=o[2].heightInSquares)&&S(e,"y2",t),r&4&&z(e,"opacity",o[2].gridOpacity||1)},d(o){o&&C(e)}}}function un(n){let e,t;return{c(){e=me("line"),S(e,"x1","0"),S(e,"y1",n[19]),S(e,"x2",t=n[2].widthInSquares),S(e,"y2",n[19]),z(e,"stroke","rgb(255,255,255)"),z(e,"stroke-width","0.01"),z(e,"opacity",n[2].gridOpacity||1)},m(o,r){E(o,e,r)},p(o,r){r&4&&t!==(t=o[2].widthInSquares)&&S(e,"x2",t),r&4&&z(e,"opacity",o[2].gridOpacity||1)},d(o){o&&C(e)}}}function fn(n){let e,t,o=n[0]&&hn(n),r=n[4].creatures,i=[];for(let s=0;s<r.length;s+=1)i[s]=dn(rn(n,r,s));return{c(){o&&o.c(),e=ee();for(let s=0;s<i.length;s+=1)i[s].c();t=ee()},m(s,c){o&&o.m(s,c),E(s,e,c);for(let l=0;l<i.length;l+=1)i[l].m(s,c);E(s,t,c)},p(s,c){if(s[0]?o?o.p(s,c):(o=hn(s),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),c&80){r=s[4].creatures;let l;for(l=0;l<r.length;l+=1){const a=rn(s,r,l);i[l]?i[l].p(a,c):(i[l]=dn(a),i[l].c(),i[l].m(t.parentNode,t))}for(;l<i.length;l+=1)i[l].d(1);i.length=r.length}},d(s){o&&o.d(s),s&&C(e),ue(i,s),s&&C(t)}}}function hn(n){let e,t,o,r,i,s,c,l;return{c(){e=me("circle"),i=me("circle"),S(e,"cx",t=n[7].x),S(e,"cy",o=n[7].y),S(e,"r",r=n[6]*n[7].reach),z(e,"fill","white"),z(e,"stroke","rgb(100,100,100)"),z(e,"opacity","0.4"),z(e,"stroke-width","0.01"),S(i,"cx",s=n[7].x),S(i,"cy",c=n[7].y),S(i,"r",l=n[6]*5),z(i,"fill","white"),z(i,"stroke","rgb(100,100,100)"),z(i,"opacity","0.4"),z(i,"stroke-width","0.01")},m(a,u){E(a,e,u),E(a,i,u)},p(a,u){u&128&&t!==(t=a[7].x)&&S(e,"cx",t),u&128&&o!==(o=a[7].y)&&S(e,"cy",o),u&192&&r!==(r=a[6]*a[7].reach)&&S(e,"r",r),u&128&&s!==(s=a[7].x)&&S(i,"cx",s),u&128&&c!==(c=a[7].y)&&S(i,"cy",c),u&64&&l!==(l=a[6]*5)&&S(i,"r",l)},d(a){a&&C(e),a&&C(i)}}}function dn(n){let e,t,o,r;return{c(){e=me("circle"),S(e,"cx",t=n[14].x),S(e,"cy",o=n[14].y),S(e,"r",r=n[6]*n[14].size),z(e,"fill",n[14].color)},m(i,s){E(i,e,s)},p(i,s){s&16&&t!==(t=i[14].x)&&S(e,"cx",t),s&16&&o!==(o=i[14].y)&&S(e,"cy",o),s&80&&r!==(r=i[6]*i[14].size)&&S(e,"r",r),s&16&&z(e,"fill",i[14].color)},d(i){i&&C(e)}}}function xr(n){let e,t,o,r=n[2]&&cn(n);return{c(){r&&r.c(),e=ee()},m(i,s){r&&r.m(i,s),E(i,e,s),t||(o=A(window,"keydown",n[8]),t=!0)},p(i,[s]){i[2]?r?r.p(i,s):(r=cn(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:N,o:N,d(i){r&&r.d(i),i&&C(e),t=!1,o()}}}function Or(n,e,t){let o,r,i;H(n,ie,m=>t(4,o=m)),H(n,et,m=>t(13,r=m)),H(n,Z,m=>t(7,i=m));let{showReach:s=!0}=e,{zoom:c=1}=e,{squareSizeInPx:l=0}=e,a,u=o.map,f=2048,d=1536,h=1;async function _(m){m.code==="ArrowLeft"&&(B(Z,i.x=Math.max(i.x-.25,0),i),m.preventDefault()),m.code==="ArrowRight"&&(B(Z,i.x=Math.max(i.x+.25,0),i),m.preventDefault()),m.code==="ArrowUp"&&(B(Z,i.y=Math.max(i.y-.25,0),i),m.preventDefault()),m.code==="ArrowDown"&&(B(Z,i.y=Math.max(i.y+.25,0),i),m.preventDefault());const{id:p,x:v,y:w}=i;r.invoke("MovePlayer",JSON.stringify({id:p,x:v,y:w})),ie.set(o)}function k(m){B(Z,i.x=m.offsetX/l,i),B(Z,i.y=m.offsetY/l,i);const{id:p,x:v,y:w}=i;r.invoke("MovePlayer",JSON.stringify({id:p,x:v,y:w})),ie.set(o)}function g(m){te[m?"unshift":"push"](()=>{a=m,t(1,a)})}return n.$$set=m=>{"showReach"in m&&t(0,s=m.showReach),"zoom"in m&&t(11,c=m.zoom),"squareSizeInPx"in m&&t(10,l=m.squareSizeInPx)},n.$$.update=()=>{n.$$.dirty&3102&&(t(2,u=o.map),u&&a&&(t(3,f=u.imageWidth*c),t(5,d=u.imageHeight*c),t(10,l=f/u.widthInSquares),console.log("square size in Map",l),t(6,h=1/u.footPerSquare)))},[s,a,u,f,o,d,h,i,_,k,l,c,g]}class Ar extends V{constructor(e){super(),J(this,e,Or,xr,K,{showReach:0,zoom:11,squareSizeInPx:10})}}function Mr(n){let e,t,o,r,i,s,c,l,a,u,f,d,h,_,k,g,m,p;return{c(){e=I("div"),t=I("input"),o=D(` Reichweite anzeigen\r
        `),r=I("br"),i=x(),s=I("br"),c=D(`\r
        Ma\xDFstab:`),l=I("br"),a=x(),u=I("input"),f=D(` ft./Quadrat\r
        `),d=I("br"),h=x(),_=I("br"),k=x(),g=I("button"),g.textContent="OK",S(t,"type","checkbox"),S(u,"type","number"),S(u,"class","w-12 border-2"),S(g,"class","border-2 rounded-xl p-2 m-2 bg-black text-white"),S(e,"class","h-full w-full bg-white rounded-xl p-8")},m(v,w){E(v,e,w),y(e,t),t.checked=n[0],y(e,o),y(e,r),y(e,i),y(e,s),y(e,c),y(e,l),y(e,a),y(e,u),ye(u,n[1]),y(e,f),y(e,d),y(e,h),y(e,_),y(e,k),y(e,g),m||(p=[A(t,"change",n[3]),A(u,"input",n[4]),A(g,"click",n[5])],m=!0)},p(v,w){w&1&&(t.checked=v[0]),w&2&&tt(u.value)!==v[1]&&ye(u,v[1])},d(v){v&&C(e),m=!1,se(p)}}}function Nr(n){let e,t,o,r,i,s,c,l;function a(f){n[6](f)}let u={$$slots:{default:[Mr]},$$scope:{ctx:n}};return n[2]!==void 0&&(u.isOpen=n[2]),e=new Tt({props:u}),te.push(()=>ce(e,"isOpen",a)),{c(){q(e.$$.fragment),o=x(),r=I("div"),i=I("button"),i.textContent="Einstellungen",S(i,"class","border-2 rounded-xl p-2 m-2 bg-black text-white"),S(r,"class","m-0 fixed bottom-4 left-4 flex items-center")},m(f,d){j(e,f,d),E(f,o,d),E(f,r,d),y(r,i),s=!0,c||(l=A(i,"click",n[7]),c=!0)},p(f,[d]){const h={};d&263&&(h.$$scope={dirty:d,ctx:f}),!t&&d&4&&(t=!0,h.isOpen=f[2],le(()=>t=!1)),e.$set(h)},i(f){s||(T(e.$$.fragment,f),s=!0)},o(f){R(e.$$.fragment,f),s=!1},d(f){L(e,f),f&&C(o),f&&C(r),c=!1,l()}}}function zr(n,e,t){let{showReach:o=!0}=e,{footPerSquare:r=5}=e,i=!1;function s(){o=this.checked,t(0,o)}function c(){r=tt(this.value),t(1,r)}const l=()=>t(2,i=!1);function a(f){i=f,t(2,i)}const u=()=>t(2,i=!0);return n.$$set=f=>{"showReach"in f&&t(0,o=f.showReach),"footPerSquare"in f&&t(1,r=f.footPerSquare)},[o,r,i,s,c,l,a,u]}class Hr extends V{constructor(e){super(),J(this,e,zr,Nr,K,{showReach:0,footPerSquare:1})}}function pn(n,e,t){const o=n.slice();return o[13]=e[t],o}function Wr(n){let e,t,o,r,i=n[2].dmg+"",s,c,l,a,u,f,d;return{c(){e=I("p"),t=D(n[0]),o=x(),r=I("button"),s=D(i),c=D(" Schaden w\xFCrfeln"),l=I("br"),a=x(),u=D(n[1]),S(r,"class","block p-2 rounded-xl bg-red-500 text-white")},m(h,_){E(h,e,_),y(e,t),y(e,o),y(e,r),y(r,s),y(r,c),y(e,l),y(e,a),y(e,u),f||(d=A(r,"click",n[8]),f=!0)},p(h,_){_&1&&Q(t,h[0]),_&4&&i!==(i=h[2].dmg+"")&&Q(s,i),_&2&&Q(u,h[1])},d(h){h&&C(e),f=!1,d()}}}function jr(n){let e,t=n[4].attacks,o=[];for(let r=0;r<t.length;r+=1)o[r]=gn(pn(n,t,r));return{c(){e=I("ul");for(let r=0;r<o.length;r+=1)o[r].c()},m(r,i){E(r,e,i);for(let s=0;s<o.length;s+=1)o[s].m(e,null)},p(r,i){if(i&48){t=r[4].attacks;let s;for(s=0;s<t.length;s+=1){const c=pn(r,t,s);o[s]?o[s].p(c,i):(o[s]=gn(c),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(r){r&&C(e),ue(o,r)}}}function gn(n){let e,t,o=n[13].name+"",r,i,s=n[13].mod+"",c,l,a=n[13].dmg+"",u,f,d,h,_;function k(){return n[7](n[13])}return{c(){e=I("button"),t=I("li"),r=D(o),i=D(" ("),c=D(s),l=D(" / Schaden: "),u=D(a),f=D(")"),d=x(),S(e,"class","block p-2")},m(g,m){E(g,e,m),y(e,t),y(t,r),y(t,i),y(t,c),y(t,l),y(t,u),y(t,f),y(e,d),h||(_=A(e,"click",k),h=!0)},p(g,m){n=g,m&16&&o!==(o=n[13].name+"")&&Q(r,o),m&16&&s!==(s=n[13].mod+"")&&Q(c,s),m&16&&a!==(a=n[13].dmg+"")&&Q(u,a)},d(g){g&&C(e),h=!1,_()}}}function Lr(n){let e,t,o,r,i;function s(a,u){return a[2]?Wr:jr}let c=s(n),l=c(n);return{c(){e=I("div"),l.c(),t=x(),o=I("button"),o.textContent="Zur\xFCck",S(o,"class","border-2 rounded-xl p-2 mt-4 bg-black text-white"),S(e,"class","h-full w-full bg-white rounded-xl p-8")},m(a,u){E(a,e,u),l.m(e,null),y(e,t),y(e,o),r||(i=A(o,"click",n[6]),r=!0)},p(a,u){c===(c=s(a))&&l?l.p(a,u):(l.d(1),l=c(a),l&&(l.c(),l.m(e,t)))},d(a){a&&C(e),l.d(),r=!1,i()}}}function Ur(n){let e,t,o,r,i,s,c;function l(u){n[9](u)}let a={$$slots:{default:[Lr]},$$scope:{ctx:n}};return n[3]!==void 0&&(a.isOpen=n[3]),e=new Tt({props:a}),te.push(()=>ce(e,"isOpen",l)),{c(){q(e.$$.fragment),o=x(),r=I("button"),r.textContent="ANGRIFF",S(r,"class","border-2 rounded-xl p-2 mr-2 bg-red-500 text-white")},m(u,f){j(e,u,f),E(u,o,f),E(u,r,f),i=!0,s||(c=A(r,"click",n[10]),s=!0)},p(u,[f]){const d={};f&65559&&(d.$$scope={dirty:f,ctx:u}),!t&&f&8&&(t=!0,d.isOpen=u[3],le(()=>t=!1)),e.$set(d)},i(u){i||(T(e.$$.fragment,u),i=!0)},o(u){R(e.$$.fragment,u),i=!1},d(u){L(e,u),u&&C(o),u&&C(r),s=!1,c()}}}function qr(n,e,t){let o;H(n,Z,g=>t(4,o=g));let r="",i="",s=null;function c(g){t(2,s=g);const m=xe.find(p=>p.name==="W20");if(m){m.number=1,m.modifier=parseInt(g.mod)||0;const p=mt([m]);t(0,r=`${p[0].total} + ${m.modifier} = ${p[0].total+m.modifier}`)}}function l(g){let m,p,v="";var w=new RegExp("(\\d+)\\s*[W|d]\\s*(\\d+)(\\s*([+-]*)\\s*(\\d+))*","g"),O=w.exec(g.dmg);O!=null&&(m=O[1],p=O[2],v=O[3]+O[4]);const P=xe.find($=>$.name==="W"+p);if(P){P.number=parseInt(m),P.modifier=parseInt(v)||0;const $=mt([P]);t(1,i=`${$[0].total} + ${P.modifier} = ${$[0].total+P.modifier}`)}}function a(g){s?l(s):c(g)}function u(){t(3,f=!1),t(0,r=""),t(1,i=""),t(2,s=null)}let f=!1;const d=g=>a(g),h=()=>a();function _(g){f=g,t(3,f)}return[r,i,s,f,o,a,u,d,h,_,()=>t(3,f=!0)]}class Br extends V{constructor(e){super(),J(this,e,qr,Ur,K,{})}}function _n(n,e,t){const o=n.slice();return o[10]=e[t],o}function Fr(n){let e,t,o=n[1].name+"",r,i,s,c,l,a,u,f,d;return a=new Br({}),a.$on("roll",n[8]),{c(){e=I("div"),t=I("button"),r=D(o),i=D(" v"),s=x(),c=I("button"),c.textContent="ZENTR",l=x(),q(a.$$.fragment),S(t,"class","mr-2 p-2 rounded-lg bg-slate-200"),S(c,"class","mr-2 p-2 rounded-lg bg-slate-200"),S(e,"class","fixed p-2 top-0 z-10")},m(h,_){E(h,e,_),y(e,t),y(t,r),y(t,i),y(e,s),y(e,c),y(e,l),j(a,e,null),u=!0,f||(d=[A(t,"click",n[7]),A(c,"click",n[4])],f=!0)},p(h,_){(!u||_&2)&&o!==(o=h[1].name+"")&&Q(r,o)},i(h){u||(T(a.$$.fragment,h),u=!0)},o(h){R(a.$$.fragment,h),u=!1},d(h){h&&C(e),L(a),f=!1,se(d)}}}function Xr(n){let e,t,o,r,i,s=n[2].creatures,c=[];for(let l=0;l<s.length;l+=1)c[l]=mn(_n(n,s,l));return{c(){e=I("div"),t=x(),o=I("div");for(let l=0;l<c.length;l+=1)c[l].c();S(e,"class","fixed left-0 top-0 bg-black opacity-50 z-30 h-screen w-screen"),S(o,"class","fixed p-2 top-0 z-50 flex portrait:flex-col")},m(l,a){E(l,e,a),E(l,t,a),E(l,o,a);for(let u=0;u<c.length;u+=1)c[u].m(o,null);r||(i=A(e,"click",n[5]),r=!0)},p(l,a){if(a&12){s=l[2].creatures;let u;for(u=0;u<s.length;u+=1){const f=_n(l,s,u);c[u]?c[u].p(f,a):(c[u]=mn(f),c[u].c(),c[u].m(o,null))}for(;u<c.length;u+=1)c[u].d(1);c.length=s.length}},i:N,o:N,d(l){l&&C(e),l&&C(t),l&&C(o),ue(c,l),r=!1,i()}}}function mn(n){let e,t=n[10].name+"",o,r,i=n[10].ini+"",s,c,l,a;function u(){return n[6](n[10])}return{c(){e=I("button"),o=D(t),r=D(" ("),s=D(i),c=D(")"),S(e,"class","m-2 p-2 rounded-lg bg-slate-200")},m(f,d){E(f,e,d),y(e,o),y(e,r),y(e,s),y(e,c),l||(a=A(e,"click",u),l=!0)},p(f,d){n=f,d&4&&t!==(t=n[10].name+"")&&Q(o,t),d&4&&i!==(i=n[10].ini+"")&&Q(s,i)},d(f){f&&C(e),l=!1,a()}}}function Qr(n){let e,t,o,r;const i=[Xr,Fr],s=[];function c(l,a){return l[0]?0:1}return e=c(n),t=s[e]=i[e](n),{c(){t.c(),o=ee()},m(l,a){s[e].m(l,a),E(l,o,a),r=!0},p(l,[a]){let u=e;e=c(l),e===u?s[e].p(l,a):(pe(),R(s[u],1,1,()=>{s[u]=null}),ge(),t=s[e],t?t.p(l,a):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(o.parentNode,o))},i(l){r||(T(t),r=!0)},o(l){R(t),r=!1},d(l){s[e].d(l),l&&C(o)}}}function Kr(n,e,t){let o,r;H(n,Z,h=>t(1,o=h)),H(n,ie,h=>t(2,r=h));const i=kt();let s=!1;function c(h){B(Z,o=h,o),t(0,s=!1),l()}function l(){i("centerMapToPlayer")}const a=()=>t(0,s=!1),u=h=>c(h),f=()=>t(0,s=!0);function d(h){Yn.call(this,n,h)}return[s,o,r,c,l,a,u,f,d]}class Yr extends V{constructor(e){super(),J(this,e,Kr,Qr,K,{})}}function Jr(n){let e,t,o=n[0]*100+"",r,i,s,c;return{c(){e=I("div"),t=I("button"),r=D(o),i=D("%"),S(t,"class","p-2 rounded-lg bg-slate-200 border-4"),S(e,"class","fixed p-2 top-0 right-0 z-10")},m(l,a){E(l,e,a),y(e,t),y(t,r),y(t,i),s||(c=A(t,"click",n[1]),s=!0)},p(l,[a]){a&1&&o!==(o=l[0]*100+"")&&Q(r,o)},i:N,o:N,d(l){l&&C(e),s=!1,c()}}}function Vr(n,e,t){let{zoom:o=1}=e;const r=kt();function i(){const s=[.5,1,1.5];let c=s.indexOf(o);c++,c>s.length-1&&(c=0),t(0,o=s[c]),r("centerMapToPlayer")}return n.$$set=s=>{"zoom"in s&&t(0,o=s.zoom)},[o,i]}class Zr extends V{constructor(e){super(),J(this,e,Vr,Jr,K,{zoom:0})}}function Gr(n){let e,t,o;function r(s){n[10](s)}let i={showReach:n[1],zoom:n[4]};return n[7]!==void 0&&(i.squareSizeInPx=n[7]),e=new Ar({props:i}),te.push(()=>ce(e,"squareSizeInPx",r)),{c(){q(e.$$.fragment)},m(s,c){j(e,s,c),o=!0},p(s,c){const l={};c&2&&(l.showReach=s[1]),c&16&&(l.zoom=s[4]),!t&&c&128&&(t=!0,l.squareSizeInPx=s[7],le(()=>t=!1)),e.$set(l)},i(s){o||(T(e.$$.fragment,s),o=!0)},o(s){R(e.$$.fragment,s),o=!1},d(s){L(e,s)}}}function ei(n){let e,t,o,r,i,s,c,l,a,u,f,d,h,_,k,g,m;de(n[9]);function p(M){n[11](M)}function v(M){n[12](M)}let w={$$slots:{default:[Gr]},$$scope:{ctx:n}};n[5]!==void 0&&(w.left=n[5]),n[6]!==void 0&&(w.top=n[6]),o=new Dr({props:w}),te.push(()=>ce(o,"left",p)),te.push(()=>ce(o,"top",v));function O(M){n[13](M)}function P(M){n[14](M)}let $={};n[1]!==void 0&&($.showReach=n[1]),n[0]!==void 0&&($.footPerSquare=n[0]),c=new Hr({props:$}),te.push(()=>ce(c,"showReach",O)),te.push(()=>ce(c,"footPerSquare",P)),f=new Yr({}),f.$on("centerMapToPlayer",n[8]);function nt(M){n[15](M)}let ot={};return n[4]!==void 0&&(ot.zoom=n[4]),h=new Zr({props:ot}),te.push(()=>ce(h,"zoom",nt)),h.$on("centerMapToPlayer",n[8]),{c(){e=I("div"),t=I("main"),q(o.$$.fragment),s=x(),q(c.$$.fragment),u=x(),q(f.$$.fragment),d=x(),q(h.$$.fragment),S(t,"class","overflow-hidden relative p-0"),z(t,"height",n[3]+"px"),z(t,"width",n[2]+"px"),S(e,"class","absolute left-0 top-0")},m(M,re){E(M,e,re),y(e,t),j(o,t,null),y(t,s),j(c,t,null),y(t,u),j(f,t,null),y(t,d),j(h,t,null),k=!0,g||(m=A(window,"resize",n[9]),g=!0)},p(M,[re]){const ze={};re&131218&&(ze.$$scope={dirty:re,ctx:M}),!r&&re&32&&(r=!0,ze.left=M[5],le(()=>r=!1)),!i&&re&64&&(i=!0,ze.top=M[6],le(()=>i=!1)),o.$set(ze);const rt={};!l&&re&2&&(l=!0,rt.showReach=M[1],le(()=>l=!1)),!a&&re&1&&(a=!0,rt.footPerSquare=M[0],le(()=>a=!1)),c.$set(rt);const Rt={};!_&&re&16&&(_=!0,Rt.zoom=M[4],le(()=>_=!1)),h.$set(Rt),(!k||re&8)&&z(t,"height",M[3]+"px"),(!k||re&4)&&z(t,"width",M[2]+"px")},i(M){k||(T(o.$$.fragment,M),T(c.$$.fragment,M),T(f.$$.fragment,M),T(h.$$.fragment,M),k=!0)},o(M){R(o.$$.fragment,M),R(c.$$.fragment,M),R(f.$$.fragment,M),R(h.$$.fragment,M),k=!1},d(M){M&&C(e),L(o),L(c),L(f),L(h),g=!1,m()}}}function ti(n,e,t){let o;H(n,Z,w=>t(16,o=w));let r=15,i=!0,s,c,l,a,u,f;function d(w){console.log("square size in setMapCenter",f),o&&(t(5,a=-(o.x*f-s/2)),t(6,u=-(o.y*f-c/2)))}function h(){t(2,s=window.innerWidth),t(3,c=window.innerHeight)}function _(w){f=w,t(7,f)}function k(w){a=w,t(5,a)}function g(w){u=w,t(6,u)}function m(w){i=w,t(1,i)}function p(w){r=w,t(0,r)}function v(w){l=w,t(4,l)}return[r,i,s,c,l,a,u,f,d,h,_,k,g,m,p,v]}class ni extends V{constructor(e){super(),J(this,e,ti,ei,K,{})}}function oi(n){return{c:N,m:N,p:N,i:N,o:N,d:N}}function ri(n){let e,t,o,r,i,s,c,l,a,u,f,d;const h=[si,ii],_=[];function k(p,v){return p[2].id?0:1}i=k(n),s=_[i]=h[i](n);function g(p){n[6](p)}let m={};return n[1]!==void 0&&(m.isOpen=n[1]),l=new Tr({props:m}),te.push(()=>ce(l,"isOpen",g)),{c(){e=I("input"),t=D(` Master\r
    `),o=I("button"),o.textContent="Szene ausw\xE4hlen",r=x(),s.c(),c=x(),q(l.$$.fragment),S(e,"type","checkbox")},m(p,v){E(p,e,v),ye(e,n[0]),E(p,t,v),E(p,o,v),E(p,r,v),_[i].m(p,v),E(p,c,v),j(l,p,v),u=!0,f||(d=[A(e,"change",n[4]),A(o,"click",n[5])],f=!0)},p(p,v){v&1&&ye(e,p[0]);let w=i;i=k(p),i===w?_[i].p(p,v):(pe(),R(_[w],1,1,()=>{_[w]=null}),ge(),s=_[i],s?s.p(p,v):(s=_[i]=h[i](p),s.c()),T(s,1),s.m(c.parentNode,c));const O={};!a&&v&2&&(a=!0,O.isOpen=p[1],le(()=>a=!1)),l.$set(O)},i(p){u||(T(s),T(l.$$.fragment,p),u=!0)},o(p){R(s),R(l.$$.fragment,p),u=!1},d(p){p&&C(e),p&&C(t),p&&C(o),p&&C(r),_[i].d(p),p&&C(c),L(l,p),f=!1,se(d)}}}function ii(n){let e;return{c(){e=I("div"),e.innerHTML=`<progress></progress><br/>
            Warte auf Spielstart...`,S(e,"class","text-center")},m(t,o){E(t,e,o)},p:N,i:N,o:N,d(t){t&&C(e)}}}function si(n){let e,t,o,r;return e=new or({props:{$$slots:{default:[hi]},$$scope:{ctx:n}}}),o=new Sr({}),{c(){q(e.$$.fragment),t=x(),q(o.$$.fragment)},m(i,s){j(e,i,s),E(i,t,s),j(o,i,s),r=!0},p(i,s){const c={};s&32769&&(c.$$scope={dirty:s,ctx:i}),e.$set(c)},i(i){r||(T(e.$$.fragment,i),T(o.$$.fragment,i),r=!0)},o(i){R(e.$$.fragment,i),R(o.$$.fragment,i),r=!1},d(i){L(e,i),i&&C(t),L(o,i)}}}function bn(n){let e,t,o,r,i,s,c,l,a,u,f;return t=new Ue({props:{to:"/",$$slots:{default:[li]},$$scope:{ctx:n}}}),s=new Ue({props:{to:"sheets",$$slots:{default:[ci]},$$scope:{ctx:n}}}),l=new Ue({props:{to:"docs",$$slots:{default:[ai]},$$scope:{ctx:n}}}),u=new Ue({props:{to:"audio",$$slots:{default:[ui]},$$scope:{ctx:n}}}),{c(){e=I("nav"),q(t.$$.fragment),o=x(),r=I("a"),r.textContent="Stage (neues Fenster)",i=x(),q(s.$$.fragment),c=x(),q(l.$$.fragment),a=x(),q(u.$$.fragment),S(r,"href","/"),S(r,"target","_new")},m(d,h){E(d,e,h),j(t,e,null),y(e,o),y(e,r),y(e,i),j(s,e,null),y(e,c),j(l,e,null),y(e,a),j(u,e,null),f=!0},i(d){f||(T(t.$$.fragment,d),T(s.$$.fragment,d),T(l.$$.fragment,d),T(u.$$.fragment,d),f=!0)},o(d){R(t.$$.fragment,d),R(s.$$.fragment,d),R(l.$$.fragment,d),R(u.$$.fragment,d),f=!1},d(d){d&&C(e),L(t),L(s),L(l),L(u)}}}function li(n){let e;return{c(){e=D("Stage")},m(t,o){E(t,e,o)},d(t){t&&C(e)}}}function ci(n){let e;return{c(){e=D("Sheets")},m(t,o){E(t,e,o)},d(t){t&&C(e)}}}function ai(n){let e;return{c(){e=D("Dokumente")},m(t,o){E(t,e,o)},d(t){t&&C(e)}}}function ui(n){let e;return{c(){e=D("Audio")},m(t,o){E(t,e,o)},d(t){t&&C(e)}}}function fi(n){let e,t;return e=new ni({}),{c(){q(e.$$.fragment)},m(o,r){j(e,o,r),t=!0},i(o){t||(T(e.$$.fragment,o),t=!0)},o(o){R(e.$$.fragment,o),t=!1},d(o){L(e,o)}}}function hi(n){let e,t,o,r,i,s,c,l,a,u,f=n[0]&&bn(n);return o=new Le({props:{path:"sheets",component:hr}}),i=new Le({props:{path:"docs",component:dr}}),c=new Le({props:{path:"audio",component:fr}}),a=new Le({props:{path:"/",$$slots:{default:[fi]},$$scope:{ctx:n}}}),{c(){f&&f.c(),e=x(),t=I("div"),q(o.$$.fragment),r=x(),q(i.$$.fragment),s=x(),q(c.$$.fragment),l=x(),q(a.$$.fragment)},m(d,h){f&&f.m(d,h),E(d,e,h),E(d,t,h),j(o,t,null),y(t,r),j(i,t,null),y(t,s),j(c,t,null),y(t,l),j(a,t,null),u=!0},p(d,h){d[0]?f?h&1&&T(f,1):(f=bn(d),f.c(),T(f,1),f.m(e.parentNode,e)):f&&(pe(),R(f,1,1,()=>{f=null}),ge());const _={};h&32768&&(_.$$scope={dirty:h,ctx:d}),a.$set(_)},i(d){u||(T(f),T(o.$$.fragment,d),T(i.$$.fragment,d),T(c.$$.fragment,d),T(a.$$.fragment,d),u=!0)},o(d){R(f),R(o.$$.fragment,d),R(i.$$.fragment,d),R(c.$$.fragment,d),R(a.$$.fragment,d),u=!1},d(d){f&&f.d(d),d&&C(e),d&&C(t),L(o),L(i),L(c),L(a)}}}function di(n){let e;return{c(){e=I("div"),e.innerHTML=`<progress></progress><br/>
        Lade Daten...`,S(e,"class","text-center")},m(t,o){E(t,e,o)},p:N,i:N,o:N,d(t){t&&C(e)}}}function pi(n){let e,t,o={ctx:n,current:null,token:null,hasCatch:!1,pending:di,then:ri,catch:oi,blocks:[,,,]};return to(n[3],o),{c(){e=ee(),o.block.c()},m(r,i){E(r,e,i),o.block.m(r,o.anchor=i),o.mount=()=>e.parentNode,o.anchor=e,t=!0},p(r,[i]){n=r,no(o,n,i)},i(r){t||(T(o.block),t=!0)},o(r){for(let i=0;i<3;i+=1){const s=o.blocks[i];R(s)}t=!1},d(r){r&&C(e),o.block.d(r),o.token=null,o=null}}}function gi(n,e,t){let o,r,i,s,c,l,a;H(n,ie,p=>t(2,o=p)),H(n,Z,p=>t(7,r=p)),H(n,pt,p=>t(8,i=p)),H(n,gt,p=>t(9,s=p)),H(n,_t,p=>t(10,c=p)),H(n,Ge,p=>t(11,l=p)),H(n,et,p=>t(12,a=p));let u=!1;B(et,a=new No().withUrl("/hubs/game").build(),a),a.on("players",p=>{console.log("players",p)}),a.on("move",p=>{const{id:v,x:w,y:O}=JSON.parse(p),P=o.creatures.find($=>$.id===v);P&&(P.x!==w||P.y!==O)&&(console.log("move creature",P.name,"to",w,O),P.x=w,P.y=O,ie.set(o),Z.set(r))}),a.on("loadScene",p=>{console.log("loadScene",p),_(p)});let f=Promise.all([(async()=>{await a.start()})(),(async()=>{let p=await fetch("/api/creatures").then(v=>v.json());p.forEach(v=>{v.x=Math.floor(Math.random()*20),v.y=Math.floor(Math.random()*15),v.ini=Math.floor(Math.random()*20)}),p.sort((v,w)=>w.ini-v.ini),B(pt,i=p,i)})(),(async()=>{B(gt,s=await fetch("/api/maps").then(p=>p.json()),s)})(),(async()=>{B(_t,c=await fetch("/api/scenes").then(p=>p.json()),c)})()]),d=(async()=>{await f,B(Ge,l=await fetch("/api/session").then(p=>p.json()),l),l.SceneId&&_(l.SceneId)})(),h=!1;function _(p){const v=c.find(w=>w.id===p);v.map=s.find(w=>w.id===v.mapId),v.creatures=v.creatureIds.map(w=>i.find(O=>O.id===w)),B(ie,o=v,o),B(Z,r=o.creatures[0],r)}function k(){u=this.value,t(0,u)}const g=()=>t(1,h=!0);function m(p){h=p,t(1,h)}return[u,h,o,d,k,g,m]}class _i extends V{constructor(e){super(),J(this,e,gi,pi,K,{})}}new _i({target:document.getElementById("app")});
